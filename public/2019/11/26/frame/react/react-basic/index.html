<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React Basic | Edsyang</title><meta name="description" content="1. 脚手架create-react-app 的使用12345678# 把模块安装在全局环境下（目的：可以使用命令），MAC电脑安装的时候，前面需要加SUDO，否则没有权限$ npm install create-react-app -g# 基于脚手架命令，创建出一个基于React的自动化&#x2F;工程化项目目录，和npm发包时候的命名规范一样，项目名称中不能出现：大写字母、中文汉字、特殊符号（-或者_是"><meta name="keywords" content="React"><meta name="author" content="Edsyang,edsyang1102@gmail.com"><meta name="copyright" content="Edsyang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.svg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React Basic"><meta name="twitter:description" content="1. 脚手架create-react-app 的使用12345678# 把模块安装在全局环境下（目的：可以使用命令），MAC电脑安装的时候，前面需要加SUDO，否则没有权限$ npm install create-react-app -g# 基于脚手架命令，创建出一个基于React的自动化&#x2F;工程化项目目录，和npm发包时候的命名规范一样，项目名称中不能出现：大写字母、中文汉字、特殊符号（-或者_是"><meta name="twitter:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><meta property="og:type" content="article"><meta property="og:title" content="React Basic"><meta property="og:url" content="http://blog.lagerstroemia.com.cn/2019/11/26/frame/react/react-basic/"><meta property="og:site_name" content="Edsyang"><meta property="og:description" content="1. 脚手架create-react-app 的使用12345678# 把模块安装在全局环境下（目的：可以使用命令），MAC电脑安装的时候，前面需要加SUDO，否则没有权限$ npm install create-react-app -g# 基于脚手架命令，创建出一个基于React的自动化&#x2F;工程化项目目录，和npm发包时候的命名规范一样，项目名称中不能出现：大写字母、中文汉字、特殊符号（-或者_是"><meta property="og:image" content="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><meta property="article:published_time" content="2019-11-26T14:24:22.420Z"><meta property="article:modified_time" content="2020-05-18T15:59:02.052Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://blog.lagerstroemia.com.cn/2019/11/26/frame/react/react-basic/"><link rel="prev" title="Redux Saga" href="http://blog.lagerstroemia.com.cn/2019/11/27/frame/react/redux-saga/"><link rel="next" title="常用方法" href="http://blog.lagerstroemia.com.cn/2019/11/26/js/usedto/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Edsyang","link":"链接: ","source":"来源: Edsyang","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Edsyang" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">124</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">44</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-脚手架"><span class="toc-number">1.</span> <span class="toc-text">1. 脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#create-react-app-的使用"><span class="toc-number">1.1.</span> <span class="toc-text">create-react-app 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-脚手架的渗入剖析"><span class="toc-number">1.2.</span> <span class="toc-text">React 脚手架的渗入剖析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-react-amp-react-dom"><span class="toc-number">2.</span> <span class="toc-text">2. react &amp; react-dom</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JSX-语法"><span class="toc-number">2.1.</span> <span class="toc-text">JSX 语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSX-语法的渲染流程（把-JSX（虚拟DOM）变为真实的DOM）"><span class="toc-number">2.2.</span> <span class="toc-text">JSX 语法的渲染流程（把 JSX（虚拟DOM）变为真实的DOM）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#原生-JS-实现-JSX"><span class="toc-number">2.3.</span> <span class="toc-text">原生 JS 实现 JSX</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createElement：创建-JSX-对象"><span class="toc-number">2.3.1.</span> <span class="toc-text">createElement：创建 JSX 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#render：把创建的对象生成DOM元素，最后插入到页面中"><span class="toc-number">2.3.2.</span> <span class="toc-text">render：把创建的对象生成DOM元素，最后插入到页面中</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-React-组件"><span class="toc-number">3.</span> <span class="toc-text">3. React 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#函数式声明组件"><span class="toc-number">3.1.</span> <span class="toc-text">函数式声明组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#封装-Dialog"><span class="toc-number">3.1.1.</span> <span class="toc-text">封装 Dialog</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于继承-Component-类来创建组件"><span class="toc-number">3.2.</span> <span class="toc-text">基于继承 Component 类来创建组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结（函数式-创建类式）"><span class="toc-number">3.3.</span> <span class="toc-text">总结（函数式&#x2F;创建类式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件中的属性管理"><span class="toc-number">3.4.</span> <span class="toc-text">组件中的属性管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组件中的状态"><span class="toc-number">3.5.</span> <span class="toc-text">组件中的状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#状态-amp-属性"><span class="toc-number">3.5.1.</span> <span class="toc-text">状态 &amp; 属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#案例：投票"><span class="toc-number">3.6.</span> <span class="toc-text">案例：投票</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据驱动思想"><span class="toc-number">3.6.1.</span> <span class="toc-text">数据驱动思想</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DOM操作思想（ref）"><span class="toc-number">3.6.2.</span> <span class="toc-text">DOM操作思想（ref）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结（受控组件-state-props-和非受控组件-ref-）"><span class="toc-number">3.7.</span> <span class="toc-text">总结（受控组件[state, props]和非受控组件[ref]）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-复合组件和单项数据流传递"><span class="toc-number">4.</span> <span class="toc-text">4. 复合组件和单项数据流传递</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于表单元素的-onChange-实现-MVVM-双向绑定"><span class="toc-number">4.1.</span> <span class="toc-text">基于表单元素的 onChange 实现 MVVM 双向绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复合组件信息传递（一）"><span class="toc-number">4.2.</span> <span class="toc-text">复合组件信息传递（一）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#封装轮播图"><span class="toc-number">4.2.1.</span> <span class="toc-text">封装轮播图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复合组件信息传递（二）"><span class="toc-number">4.3.</span> <span class="toc-text">复合组件信息传递（二）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#复合组件案例"><span class="toc-number">4.3.1.</span> <span class="toc-text">复合组件案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#平行组件案例"><span class="toc-number">4.3.2.</span> <span class="toc-text">平行组件案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redux-amp-React-Redux"><span class="toc-number">4.4.</span> <span class="toc-text">Redux &amp; React-Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-基础流程"><span class="toc-number">4.4.1.</span> <span class="toc-text">Redux 基础流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-工程化结构"><span class="toc-number">4.4.2.</span> <span class="toc-text">Redux 工程化结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-中间件"><span class="toc-number">4.4.3.</span> <span class="toc-text">Redux 中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#中间件的实现"><span class="toc-number">4.4.4.</span> <span class="toc-text">中间件的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React-Redux-流程"><span class="toc-number">4.4.5.</span> <span class="toc-text">React-Redux 流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-amp-React-Redux-流程-机制"><span class="toc-number">4.5.</span> <span class="toc-text">React &amp; React-Redux 流程&#x2F;机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux"><span class="toc-number">4.5.1.</span> <span class="toc-text">Redux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React-Redux"><span class="toc-number">4.5.2.</span> <span class="toc-text">React-Redux</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redux-amp-React-Redux-原理"><span class="toc-number">4.6.</span> <span class="toc-text">Redux &amp; React-Redux 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-原理之-createStore"><span class="toc-number">4.6.1.</span> <span class="toc-text">Redux 原理之 createStore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-原理之-combineReducers"><span class="toc-number">4.6.2.</span> <span class="toc-text">Redux 原理之 combineReducers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React-Redux-原理之-Provider"><span class="toc-number">4.6.3.</span> <span class="toc-text">React-Redux 原理之 Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React-Redux-原理之-connect"><span class="toc-number">4.6.4.</span> <span class="toc-text">React-Redux 原理之 connect</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-React-组件的生命周期函数"><span class="toc-number">5.</span> <span class="toc-text">5. React 组件的生命周期函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-React-路由"><span class="toc-number">6.</span> <span class="toc-text">6. React 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单页面应用-amp-多页面应用"><span class="toc-number">6.1.</span> <span class="toc-text">单页面应用 &amp; 多页面应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-react-路由-react-router-dom-实现单页面应用"><span class="toc-number">6.2.</span> <span class="toc-text">使用 react 路由 (react-router-dom) 实现单页面应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BrowserRouter-VS-HashRouter-VS-MemoryRouter"><span class="toc-number">6.3.</span> <span class="toc-text">BrowserRouter VS HashRouter VS MemoryRouter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashRouter-amp-Route"><span class="toc-number">6.4.</span> <span class="toc-text">HashRouter &amp; Route</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch-amp-Redirect"><span class="toc-number">6.5.</span> <span class="toc-text">Switch &amp; Redirect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NavLink-amp-Link"><span class="toc-number">6.6.</span> <span class="toc-text">NavLink &amp; Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#withRouter"><span class="toc-number">6.7.</span> <span class="toc-text">withRouter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#受路由管控组件的特点"><span class="toc-number">6.8.</span> <span class="toc-text">受路由管控组件的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义菜单（MenuLink）"><span class="toc-number">6.9.</span> <span class="toc-text">自定义菜单（MenuLink）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prompt"><span class="toc-number">6.10.</span> <span class="toc-text">Prompt</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-React-常见问题"><span class="toc-number">7.</span> <span class="toc-text">7. React 常见问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-React-基础知识复习"><span class="toc-number">8.</span> <span class="toc-text">8. React 基础知识复习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-CRM-系统的结构"><span class="toc-number">9.</span> <span class="toc-text">9. CRM 系统的结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Demo-Project"><span class="toc-number">10.</span> <span class="toc-text">10. Demo Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CRM"><span class="toc-number">10.1.</span> <span class="toc-text">CRM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#component"><span class="toc-number">10.1.1.</span> <span class="toc-text">component</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#routes"><span class="toc-number">10.1.2.</span> <span class="toc-text">routes</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Edsyang</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">React Basic</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-11-26 14:24:22"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-11-26</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-05-18 15:59:02"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-05-18</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Frame/">Frame</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Frame/react/">react</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">30.5k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 124 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="1-脚手架"><a href="#1-脚手架" class="headerlink" title="1. 脚手架"></a>1. 脚手架</h2><h3 id="create-react-app-的使用"><a href="#create-react-app-的使用" class="headerlink" title="create-react-app 的使用"></a>create-react-app 的使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 把模块安装在全局环境下（目的：可以使用命令），MAC电脑安装的时候，前面需要加SUDO，否则没有权限</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install create-react-app -g</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 基于脚手架命令，创建出一个基于React的自动化/工程化项目目录，和npm发包时候的命名规范一样，项目名称中不能出现：大写字母、中文汉字、特殊符号（-或者_是可以的）等</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> create-react-app [项目名称]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入项目中并启动项目</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> 项目名称 &amp;&amp; npm start</span></span><br></pre></td></tr></table></figure>

<p><strong>脚手架生成目录中的一些内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">|___ node_modules 当前项目中依赖的包都安装在这里</span><br><span class="line">	|___ .bin 本地项目中可执行命令，在package.json 的scripts中配置对应的脚本即可（其中有一个就是：react-scripts命令）</span><br><span class="line">|___ public 存放的是当前项目的HTML页面（单页面应用放一个index.html即可，多页面根据自己需求放置需要的页面）</span><br><span class="line">	【在REACT框架中，所有的逻辑都是在JS中完成的（包括页面结构的创建），如果想给当前的页面导入一些CSS样式或者IMG图片等内容，我们有两种方式：</span><br><span class="line">		1. 在JS中基于ES6 Module模块规范，使用import导入，这样webpack在编译合并JS的时候，会把导入的资源文件等插入到页面的结构中（绝对不能在JS管控的结构中通过相对目录.&#x2F;或者..&#x2F;，导入资源，因为在webpack编译的时候，地址就不再是之前的相对地址了</span><br><span class="line">		2. 如果不想在JS中导入（JS中导入的资源最后都会基于webpack编译），也可以把资源手动的在HTML中导入，但是HTML最后也要基于webpack编译，导入的地址也不建议写相对地址，而是使用 %PUBLIC_URL% 写成绝对地址】</span><br><span class="line">|___ src 项目结构中最主要的目录，因为后期所有的JS、路由、组件等都是放到这里面（包括需要编写的CSS或者图片等）</span><br><span class="line">	|___ index.js 当前项目的入口文件</span><br><span class="line">|___ .gitignore git提交的时候，忽略提交文件的配置项</span><br><span class="line">|___ package.json 当前项目的配置清单</span><br><span class="line">	【dependencies：基于脚手架生成工程目录，自动安装了三个模块：react&#x2F;react-dom&#x2F;react-scripts（react-scripts集成了webpack需要的内容 - babel、css处理、eslint、webpack...，但没有less&#x2F;sass的处理内容，需要的话自己安装）】</span><br><span class="line">	【scripts：可执行的脚本 </span><br><span class="line">		[start]：开发环境下，基于webpack编译处理，最后可以预览当前开发的项目成果（在webpack中安装webpack-dev-server插件，基于这个插件会自动创建一个web服务，端口号默认是3000，webpack会帮我们自动打开浏览器，并且展示我们的页面，并且能够监听代码的改变，如果代码改变了，webpack会自动重新编译，并且刷新浏览器来完成重新渲染）</span><br><span class="line">		[build]：项目需要部署到服务器上，先执行 yarn build，把项目整体编译打包（完成后会在项目中生成一个build文件夹，这个文件夹中包含了所有编译后的内容，把它上传到服务器即可），而且在服务上进行部署的时候，不需要安装任何模块了（因为webpack已经把需要的内容都打包到一个JS中了】</span><br></pre></td></tr></table></figure>

<h3 id="React-脚手架的渗入剖析"><a href="#React-脚手架的渗入剖析" class="headerlink" title="React 脚手架的渗入剖析"></a>React 脚手架的渗入剖析</h3><blockquote>
<p>create-react-app脚手架为了让结构目录清晰，把安装的webpack及配置文件都集成在了react-scripts模块中，放到node_modules中，但是真是项目中，我们需要在脚手架默认安装的基础上，额外安装一些需要的模块，例如：react-router-dom/axios… 再比如：less/sass…</p>
</blockquote>
<ul>
<li><p>情况一：如果安装其他的组件，但是安装成功后不需要修改webpack的配置项，此时我们直接的安装，并且调取使用即可<code>import xxx from &#39;xxx&#39;</code></p>
</li>
<li><p>情况二：安装的插件是基于webpack处理的，也就是需要把安装的模块配置到webpack中（重新修改webpack配置项）</p>
<ul>
<li><p>首先需要把隐藏到node_modules中的配置项暴漏到项目中</p>
<blockquote>
<p>$ yarn eject</p>
<p>· 首先会确认是否执行eject操作，这个操作是不可逆转的，一旦暴漏出来配置项，就无法再隐藏回去</p>
<p>· 如果当前的项目基于git管理，在执行eject时，如果还有没提交到历史区的内容，需要先提交到历史区，然后再eject才可以，否则报错：This git repository has untracked files or uncommitted changes…</p>
</blockquote>
</li>
<li><p>再去修改对应的配置项即可</p>
<blockquote>
<p>一旦暴漏后，项目目录中多了两个文件夹</p>
<ul>
<li><p>config 存放的是webpack的配置文件</p>
<ul>
<li>webpack.config.dev.js 开发环境下的配置项（yarn start）</li>
<li>webpack.config.prod.js 生产环境下的配置项（yarn build）</li>
</ul>
</li>
<li><p>scripts 存放的事可执行脚本的JS文件</p>
<ul>
<li>start.js    yarn start执行的就是这个JS</li>
<li>build.js    yarn build执行的就是这个JS</li>
</ul>
</li>
</ul>
<p>package.json中的内容也改了</p>
<p>【举个例子：需要配置less】</p>
<p>​        $ yarn add less less-loader</p>
<p>​        less是开发和生产环境下都需要配置的（webpack.config.dev/prod.js）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	text: <span class="regexp">/\.(css|less)$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    loader: <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">    ...</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>预览项目时，也实现基于webpack编译，把编译后的内容放到浏览器中运行，所以如果项目中使用了less，需要修改webpack配置项，在配置项中加入less的编译工作，这样后期预览项目，首先基于webpack把less编译为css，然后再呈现在页面中</p>
</blockquote>
<ul>
<li><p>$ <code>set HTTPS=true&amp;npm start</code> 开启/设置为HTTPS协议模式（设置环境变量HTTPS的值）</p>
</li>
<li><p>$ <code>set PORT=43213&amp;npm start</code> 修改默认端口号</p>
</li>
<li><p>$ <code>set HTTPS=false&amp;set PORT=3000&amp;npm start</code> 设置回默认值</p>
</li>
<li><p>Question：你在项目中是怎么进行环境区分的？通过设置process.env.NODE_ENV = ‘developement/production’</p>
</li>
</ul>
<h2 id="2-react-amp-react-dom"><a href="#2-react-amp-react-dom" class="headerlink" title="2. react &amp; react-dom"></a>2. react &amp; react-dom</h2><ul>
<li>【渐进式框架：一种最流行的框架思想，一般框架中都包含很多内容，这样导致框架的体积过于臃肿，拖慢加载速度，真是项目中，使用一个框架，不一定用到所有的功能，此时应该把框架的功能进行拆分，用户想用什么让其自由组合即可】<ul>
<li>全家桶：渐进式框架N多部分的组合<ul>
<li>VUE 全家桶：vue / vue-cli / vue-router / vuex / axios(fetch) / vue element(vant)</li>
<li>REACT 全家桶：react / create-react-app / react-dom / react-router / redux / react-redux / axios / antd / dva / saga / mobx…</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><p><code>react.js</code>：react 框架的核心部分，提供了Component类可以供我们进行组件开发，提供了钩子函数（生命周期函数：所有的生命周期函数都是基于回调函数完成的）</p>
<blockquote>
<p><strong>react 导入过程</strong></p>
<ol>
<li><p>先找到node_modules下的react</p>
</li>
<li><p>找到package.json（”main”: “index.js”）</p>
</li>
<li><p>找到index.js</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./cjs/react.production.min.js'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> 	<span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'./cjs/react.development.js'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>再找到./cjs/react.production.min.js 或者 ./cjs/react.development.js</p>
</li>
<li><p>其中就会把 render() 中的第一个参数渲染到 public 文件夹中的 index.html 中 <code>&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</code> 里面去</p>
</li>
</ol>
</blockquote>
</li>
<li><p><code>react-dom.js</code>：把JSX语法渲染为真实DOM（能够放到页面中展示的结构都叫做真实DOM）的组件</p>
</li>
</ol>
<blockquote>
<p>JSX 中调取组件，只需要把组件当作一个标签调取使用即可（单闭合和双闭合都可以）</p>
</blockquote>
<h3 id="JSX-语法"><a href="#JSX-语法" class="headerlink" title="JSX 语法"></a>JSX 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render([JSX], [CONTAINER], [CALLBACK]): 把JSX元素渲染到页面中</span><br><span class="line">	JSX: react虚拟元素</span><br><span class="line">	CONTAINER: 容器，想把元素放到页面中的哪个容器中</span><br><span class="line">	CALLBACK: 当把内容放到页面中呈现触发的回调函数</span><br></pre></td></tr></table></figure>

<p>JSX：react 独有的语法，JavaScript + XML（HTML），和之前拼接的HTML字符串类似，都是把 HTML 结构代码和 JS 代码或者数据混合在一起了，但它不是字符串</p>
<ol>
<li><p>不建议把 JSX 直接渲染到 body 中，而是放在自己创建一个容器中，一般都放在一个 id 为root 的 div 中即可</p>
</li>
<li><p>在JSX中出现的 {} 是存放JS的，但是要求JS代码执行完成有返回结果（JS表达式）</p>
<p>-&gt; 不能直接放一个对象数据类型的值（对象（除了给style赋值）、数组（数组中如果没有对象，都是基本值或者JSX元素，这样是可以的）、函数都不行）</p>
<p>-&gt; 可以是基本类型的值（布尔类型什么都不显示、null、undefined也是 JSX 元素，代表的是空）</p>
<p>-&gt; 循环判断的语句都不支持，但是支持三元运算符</p>
</li>
</ol>
<ol start="3">
<li>循环数组创建 JSX 元素（一般都基于数组map方法完成迭代），需要给创建的元素设置唯一的key值（当前本次循环内唯一即可）</li>
<li>只能出现一个根元素</li>
<li>给元素设置样式类用的是className而不是class</li>
<li>style中不能直接的写样式字符串，需要基于一个样式来遍历赋值</li>
</ol>
<h3 id="JSX-语法的渲染流程（把-JSX（虚拟DOM）变为真实的DOM）"><a href="#JSX-语法的渲染流程（把-JSX（虚拟DOM）变为真实的DOM）" class="headerlink" title="JSX 语法的渲染流程（把 JSX（虚拟DOM）变为真实的DOM）"></a>JSX 语法的渲染流程（把 JSX（虚拟DOM）变为真实的DOM）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> styleObj = &#123;...&#125;</span><br><span class="line">React.render(<span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">'box'</span> <span class="attr">className</span>=<span class="string">'title'</span> <span class="attr">style</span>=<span class="string">&#123;styleObj&#125;</span>&gt;</span>珠<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>))</span><br></pre></td></tr></table></figure>

<p><strong>JSX渲染机制</strong></p>
<ol>
<li><p>基于babel中的语法解析模块（babel-preset-react）把JSX语法编译为React.createElement(…) 结构【JSX 是 createElement 的语法糖】</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">React.createElement(</span><br><span class="line">	<span class="string">'h1'</span>,</span><br><span class="line">	&#123;<span class="attr">id</span>: <span class="string">'box'</span>, <span class="attr">className</span>: <span class="string">'title'</span>, <span class="attr">style</span>: styleObj&#125;,</span><br><span class="line">	<span class="string">'\u73E0'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行React.createElement(type, props, children)，创建一个对象（虚拟DOM）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">type: <span class="string">'h1'</span></span><br><span class="line">props: &#123;</span><br><span class="line">	id: <span class="string">'box'</span>,</span><br><span class="line">	className: <span class="string">'title'</span>,</span><br><span class="line">	style: styleObj,</span><br><span class="line">	children: <span class="string">'珠'</span> =&gt; 存放的是元素中的内容</span><br><span class="line">&#125;</span><br><span class="line">ref: <span class="literal">null</span></span><br><span class="line">key: <span class="literal">null</span></span><br><span class="line">...</span><br><span class="line">__proto__: <span class="built_in">Object</span>.prototype</span><br></pre></td></tr></table></figure>
</li>
<li><p>ReactDOM.render(JSX语法最后生成的对象,容器)，基于render方法把生成的对象动态创建为DOM元素，插入到指定的容器中</p>
</li>
</ol>
<h3 id="原生-JS-实现-JSX"><a href="#原生-JS-实现-JSX" class="headerlink" title="原生 JS 实现 JSX"></a>原生 JS 实现 JSX</h3><h4 id="createElement：创建-JSX-对象"><a href="#createElement：创建-JSX-对象" class="headerlink" title="createElement：创建 JSX 对象"></a>createElement：创建 JSX 对象</h4><blockquote>
<p>参数：至少两个 type / props，children这部分可能没有、可能有多个</p>
</blockquote>
<ol>
<li><p>创建一个对象（默认有四个属性：TYPE / PROPS / REF / KEY），最后要把这个对象返回</p>
</li>
<li><p>根据传递的值修改这个对象</p>
<ul>
<li><p>TYPE =&gt; 传递的type</p>
</li>
<li><p>PROPS 需要做一些处理：大部分传递props中的属性都赋值给对象的props，有一些比较特殊</p>
</li>
<li><p>如果是ref或者key，需要把传递的props中的这两个属性值，给创建对象的两个属性，而传递的props中把这两个值删除掉</p>
<ul>
<li>把传递的children作为新创建对象的props中的一个属性</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, children</span>) </span>&#123;</span><br><span class="line">  props = props || &#123;&#125;</span><br><span class="line">  <span class="comment">//=&gt; 创建一个对象，设置一些默认的属性值</span></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;</span><br><span class="line">    type: <span class="literal">null</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">      children: <span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ref: <span class="literal">null</span>,</span><br><span class="line">    key: <span class="literal">null</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//=&gt; 用传递的type和props覆盖原有的默认值</span></span><br><span class="line">  <span class="comment">// obj = &#123;...obj, type, props&#125;; //=&gt;&#123;type:type,props:props&#125;</span></span><br><span class="line">  obj = &#123;...obj, type, <span class="attr">props</span>: &#123;...props, children&#125;&#125;;</span><br><span class="line">  <span class="comment">//=&gt; 把ref和key提取出来（并且删除props中的属性）</span></span><br><span class="line">  <span class="string">'key'</span> <span class="keyword">in</span> obj.props </span><br><span class="line">    ? (obj.key = obj.props.key, obj.props.key = <span class="literal">undefined</span>) </span><br><span class="line">  	: <span class="literal">null</span>;</span><br><span class="line">  <span class="string">'ref'</span> <span class="keyword">in</span> obj.props </span><br><span class="line">    ? (obj.key = obj.props.key, obj.props.key = <span class="literal">undefined</span>) </span><br><span class="line">  	: <span class="literal">null</span>;	</span><br><span class="line">	<span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> objJSX = createElement(</span><br><span class="line">	<span class="string">'h1'</span>,</span><br><span class="line">	&#123;<span class="attr">id</span>: <span class="string">'box'</span>, <span class="attr">className</span>: <span class="string">'title'</span>, <span class="attr">style</span>: styleObj, <span class="attr">ref</span>: <span class="string">'AA'</span>, <span class="attr">key</span>: <span class="string">'12'</span>&#125;,</span><br><span class="line">	<span class="string">'\u73E0'</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">console</span>.log(objJSX);</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *		type: 'h1'</span></span><br><span class="line"><span class="comment"> *		props: &#123;</span></span><br><span class="line"><span class="comment"> *			id: 'box',</span></span><br><span class="line"><span class="comment"> *			className: 'title',</span></span><br><span class="line"><span class="comment"> *			style: styleObj,</span></span><br><span class="line"><span class="comment"> *			children: '珠', =&gt; 存放的是元素中的内容</span></span><br><span class="line"><span class="comment"> *			ref: undefined,</span></span><br><span class="line"><span class="comment"> * 			key: undefined</span></span><br><span class="line"><span class="comment"> *		&#125;,</span></span><br><span class="line"><span class="comment"> *		ref: 'AA',</span></span><br><span class="line"><span class="comment"> *		key: '12'</span></span><br><span class="line"><span class="comment"> *		__proto__: Object.prototype</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h4 id="render：把创建的对象生成DOM元素，最后插入到页面中"><a href="#render：把创建的对象生成DOM元素，最后插入到页面中" class="headerlink" title="render：把创建的对象生成DOM元素，最后插入到页面中"></a>render：把创建的对象生成DOM元素，最后插入到页面中</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">obj = &#123;&#125;, container, callBack</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;type, props&#125; = obj || &#123;&#125;,</span><br><span class="line">      newElement = <span class="built_in">document</span>.createElement(type);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!props.hasOwnProperty(attr)) <span class="keyword">break</span>; <span class="comment">//=&gt; 不是私有的直接结束遍历</span></span><br><span class="line">    <span class="keyword">if</span> (!props[attr]) <span class="keyword">continue</span>; <span class="comment">//=&gt; 如果当前属性没有值，直接不处理即可</span></span><br><span class="line">    <span class="keyword">let</span> value = props[attr];</span><br><span class="line">    <span class="comment">//=&gt; className</span></span><br><span class="line">    <span class="keyword">if</span> (attr === <span class="string">'className'</span>) &#123;</span><br><span class="line">      newElement.setAttribute(<span class="string">'class'</span>, value);</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt; style</span></span><br><span class="line">    <span class="keyword">if</span> (attr === <span class="string">'style'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="string">''</span>) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> styKey <span class="keyword">in</span> value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value.hasOwnProperty(styKey)) &#123;</span><br><span class="line">          newElement[<span class="string">'style'</span>][styKey] = value[styKey]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt; children</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 可能是一个值：可能是字符串也可能是一个JSX对象</span></span><br><span class="line"><span class="comment">     * 可能是一个数组：数组中的每一项可能是字符串也可能是JSX对象</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">if</span> (attr === <span class="string">'children'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(value <span class="keyword">instanceof</span> <span class="built_in">Array</span>)) &#123;</span><br><span class="line">        value = [value]</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="comment">//=&gt; 首先把一个值也变为数组，这样后期统一操作数组即可</span></span><br><span class="line">      value.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//=&gt; 验证item是什么类型的：如果是字符串就是创建文本节点，如果是对象，需要再次执行render方法，把创建的元素放到最开始创建的大盒子中</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'string'</span>) &#123;</span><br><span class="line">        	<span class="comment">//=&gt; 如果只有一个值，创建一个文本节点即可</span></span><br><span class="line">        	<span class="keyword">let</span> text = <span class="built_in">document</span>.createTextNode(value) <span class="comment">// 创建一个文本节点</span></span><br><span class="line">        	newElement.appendChild(text)</span><br><span class="line">      	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          render(item, newElement)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt; 基于setAttribute可以让设置的属性表现在HTML的结构上</span></span><br><span class="line">    newElement.setAttribute(attr, value)</span><br><span class="line">  &#125;</span><br><span class="line">  container.appendChild(newElement);</span><br><span class="line">  callBack &amp;&amp; callBack()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(objJSX, root, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ok'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-React-组件"><a href="#3-React-组件" class="headerlink" title="3. React 组件"></a>3. React 组件</h2><p>不管是 Vue 还是 React 框架，设计之初都是期望我们按照‘组件/模块管理’的方式来构建程序的，也就是把一个程序划分为一个个的组件来单独处理</p>
<blockquote>
<p>组件化：可以很直观的将一个复杂的页面分割成若干个独立组件,每个组件包含自己的逻辑和样式 再将这些独立组件组合完成一个复杂的页面。 这样既减少了逻辑复杂度，又实现了代码的重用</p>
</blockquote>
<ul>
<li>优势<ul>
<li>可组合：一个组件可以和其他的组件一起使用或者可以直接嵌套在另一个组件内部</li>
<li>可重用：每个组件都是具有独立功能的，它可以被使用在多个场景中</li>
<li>可维护：每个小的组件仅仅包含自身的逻辑，更容易被理解和维护</li>
</ul>
</li>
<li>组件的特点声明方式<ul>
<li>首字母必须大写,目的是为了和 JSX 元素进行区分</li>
<li>组件定义后可以像 JSX 元素一样进行使用</li>
<li>每个组件必须返回唯一的顶级 JSX 元素</li>
<li>可以通过 render 方法将组件渲染成真实 DOM</li>
</ul>
</li>
<li>React 中创建组件有两种方式<ul>
<li>函数声明式组件</li>
<li>基于继承 Component 类来创建组件</li>
</ul>
</li>
</ul>
<blockquote>
<p>src -&gt; component：这个文件夹中存放的就是开发的组件</p>
</blockquote>
<h3 id="函数式声明组件"><a href="#函数式声明组件" class="headerlink" title="函数式声明组件"></a>函数式声明组件</h3><blockquote>
<p>每一个组件中都要导入 React，因为需要基于它的 createElement 把 JSX 进行解析渲染</p>
</blockquote>
<ol>
<li>函数返回结果是一个新的 JSX（也就是当前组件的 JSX 结构）</li>
<li>Props 变量存储的值是一个对象，包含了调取组件式传递的属性值（不传递是一个空对象）</li>
</ol>
<blockquote>
<p>知识点</p>
<ul>
<li><p>createElement 在处理的时候，遇到一个组件，返回的对象中：type 就不再是字符串标签名了，而是一个函数（类），但是属性还是存在 props 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: Dialog,</span><br><span class="line">  props: &#123;</span><br><span class="line">    lx: <span class="number">1</span>,</span><br><span class="line">  	con: <span class="string">'xxx'</span>,</span><br><span class="line">  	children: 一个值或者一个数组 </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>render 渲染的时候，我们需要做处理，首先判断 type 类型，</p>
<ul>
<li>如果是字符串，就创建一个元素标签；</li>
<li>如果是字符串，就创建一个元素类型；</li>
<li>如果函数或者类，就把函数执行，把 props 中的每一项（包含 children）传递给函数</li>
</ul>
</li>
<li><p>在执行函数的时候，把函数中 return 的 JSX 转换为新的对象（通过 createElement），把这个对象返回；紧接着 render 按照以往的渲染方式，创建 DOM 元素，插入到指定的容器中即可</p>
</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/Dialog.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Dialog</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;con, lx = <span class="number">0</span>, children, style = &#123;&#125;&#125; = props,</span><br><span class="line">      title = lx === <span class="number">0</span> ? <span class="string">'系统提示'</span> : <span class="string">'系统警告'</span>;</span><br><span class="line">  <span class="comment">//=&gt; children：可能有可能没有，可能只是一个值也可能是一个数组，可能每一项是一个字符串也肯跟是一个对象等（代表双闭合组件中的子元素）</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;con&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  	&#123;/*把属性中传递的子元素放到组件中的指定位置*/&#125;</span></span><br><span class="line"><span class="xml">  	&#123;children&#125;</span></span><br><span class="line"><span class="xml">  	&#123;/*也可以基于React中提供的专门遍历children的方法来完成遍历操作*/&#125;</span></span><br><span class="line"><span class="xml">  	&#123;</span></span><br><span class="line"><span class="xml">    	React.Children.map(children, item =&gt; item)</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Dialog <span class="keyword">from</span> <span class="string">'./component/Dialog'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">con</span>=<span class="string">'哈哈哈'</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> '<span class="attr">red</span>'&#125;&#125;/&gt;</span></span></span><br><span class="line">	&lt;Dialog con='嘿嘿嘿' lx=&#123;1&#125;&gt;</span><br><span class="line">  	&lt;span&gt;1&lt;/span&gt;</span><br><span class="line">  	&lt;span&gt;2&lt;/span&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Dialog</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br></pre></td></tr></table></figure>

<h4 id="封装-Dialog"><a href="#封装-Dialog" class="headerlink" title="封装 Dialog"></a>封装 Dialog</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Dialog.js // </span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Dialog</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;type, content, children&#125; = props;</span><br><span class="line">  <span class="comment">//=&gt; 自己处理的一些样式</span></span><br><span class="line">  <span class="keyword">let</span> objStyle = &#123;<span class="string">"width"</span>: <span class="string">'50%'</span>&#125;</span><br><span class="line">  <span class="comment">//=&gt; 类型的处理</span></span><br><span class="line">  <span class="keyword">let</span> typeValue = type || <span class="string">'系统提示'</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        typeValue: <span class="string">'系统提示'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        typeValue: <span class="string">'系统警告'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        typeValue: <span class="string">'系统错误'</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span> <span class="attr">style</span>=<span class="string">&#123;objStyle&#125;</span>&gt;</span></span></span><br><span class="line">  	&lt;div className='panel-heading'&gt;</span><br><span class="line">    	&lt;h3 className='panel-title'&gt;系统提示&lt;/h3&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  	<span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'panel-body'</span>&gt;</span>&#123;content&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/*如果传递了children，把内容放到尾部中，不传递什么都不显示*/&#125;</span></span><br><span class="line"><span class="xml">    	&#123;</span></span><br><span class="line"><span class="xml">      	children </span></span><br><span class="line"><span class="xml">      		? <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'panel-footer'</span>&gt;</span>&#123;React.Children.map(children, item =&gt; item)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          : null</span></span><br><span class="line"><span class="xml">    	&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js //</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./static/css/reset.css'</span></span><br><span class="line"><span class="comment">// 1. 一般都把程序中的公用样式放到index中导入，这样在其他组件中也可以使用了（webpack会把所有的组件最后都编译到一起，index是主入口）</span></span><br><span class="line"><span class="comment">// 2. 导入bootstrap，需要导入的是不经过压缩处理的文件，否则无法编译（真实项目中bootstrap已经是过去时，后期项目中使用组件都使用ant来做）</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line"><span class="keyword">import</span> Dialog <span class="keyword">from</span> <span class="string">'./component/Dialog'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">content</span>=<span class="string">'aaaaaa'</span>/&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">type</span>=<span class="string">&#123;2&#125;</span> <span class="attr">content</span>=<span class="string">'bbbbbb'</span>/&gt;</span></span></span><br><span class="line"> 	&lt;Dialog type='请登录' content=&#123;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    	&lt;input type='text' class='form-control' placeholder='请输入用户名'&gt;</span><br><span class="line">      &lt;input type='password' class='form-control' placeholder='请输入密码'&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;&gt;</span><br><span class="line">  	&lt;button className='btn btn-success'&gt;login&lt;/button&gt;</span><br><span class="line">		&lt;br/&gt;</span><br><span class="line">  	&lt;button className='btn btn-danger'&gt;cancel&lt;/button&gt;  </span><br><span class="line">  &lt;/Dialog&gt;</span><br><span class="line">&lt;/main&gt;)</span><br></pre></td></tr></table></figure>

<h3 id="基于继承-Component-类来创建组件"><a href="#基于继承-Component-类来创建组件" class="headerlink" title="基于继承 Component 类来创建组件"></a>基于继承 Component 类来创建组件</h3><p>基于 createElement 把 JSX 转换为一个对象，当 render 渲染这个对象的时候，遇到 type 是一个函数或者类，不是直接创建元素，而是先把方法执行：</p>
<ul>
<li><p>如果是函数式声明的组件，就把它当作普通方法执行（方法中的 this 是 undefined），把函数返回的 JSX 元素（也是解析后的对象）进行渲染</p>
</li>
<li><p>如果是类声明式的组件，会把当前类 new 它执行，创建类的一个实例（当前本次调取的组件就是它的实例），执行 constructor 之后，会执行 this.render()，把 render 中返回的 JSX 拿过来渲染，所以“类声明式组件，必须有一个 render 的方法，方法中需要返回一个 JSX 元素”</p>
</li>
<li><p>但不管是哪一种方式，最后都会把解析出来的 props 属性对象作为实参传递给对应的函数或者类</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/Dialog</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sum</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(props);<span class="comment">//=&gt; undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dialog</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123; <span class="comment">//=&gt; props, context, updater</span></span><br><span class="line">    <span class="keyword">super</span>(props); <span class="comment">//=&gt; ES6中extends继承，一旦使用了constructor。第一行的位置必须设置super执行；相当于React.Component.call(this)，也就是call继承，把父类私有的属性继承过来</span></span><br><span class="line">    <span class="comment">//=&gt; 如果只写 super()：虽然创建实例的时候把属性传递进来了，但是并没有传递父组件，也就是没有把属性挂载到实例上，使用 this.props 获取的结果是 undefined</span></span><br><span class="line">    <span class="comment">//=&gt; 如果 super(props)：在继承父类私有的时候，就把传递的属性挂载到了子类的实例上，constructor 中就可以使用 this.props 了</span></span><br><span class="line">    <span class="comment">//=&gt; 即使在 constructor 中不设置形参 props 接受属性，执行 super 的时候也不传这个属性，除了 constructor 中不能直接使用 this.props，其他生命周期函数中都可以使用（也就是执行完成 constructor，react 已经帮我们把传递的属性接收并且挂载到实例上了）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//=&gt; props：当 render 渲染并且把当前类执行创建实例的时候，会把之前 JSX 解析出来的 props 对象中的信息（可能有 children）传递给参数 props =&gt; “调取组件传递的属性”</span></span><br><span class="line">    <span class="built_in">console</span>.log(props);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * this.props: 属性集合</span></span><br><span class="line"><span class="comment">     * this.refs: ref集合（非受控组件中用到）</span></span><br><span class="line"><span class="comment">     * this.context: 上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 第一次渲染之前</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;lx, con&#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;lx&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;con&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	edsyang	                </span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">lx</span>=<span class="string">&#123;</span>'系统提示'&#125; <span class="attr">con</span>=<span class="string">"嘿嘿嘿"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, root)</span><br><span class="line">                </span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">	type: <span class="string">'div'</span>,</span><br><span class="line">	props: &#123;</span><br><span class="line">		children: [</span><br><span class="line">			<span class="string">'edsyang'</span>,</span><br><span class="line">			&#123;</span><br><span class="line">      	type: Dialog,</span><br><span class="line">				props: &#123;</span><br><span class="line">        	lx: <span class="number">2</span>        </span><br><span class="line">        &#125;                </span><br><span class="line">      &#125;	                </span><br><span class="line">    ]                </span><br><span class="line">  &#125;                </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结（函数式-创建类式）"><a href="#总结（函数式-创建类式）" class="headerlink" title="总结（函数式/创建类式）"></a>总结（函数式/创建类式）</h3><p>创建组件有两种方式“函数式”、“创建类式”</p>
<ul>
<li><p>函数式</p>
<ol>
<li>操作非常简单</li>
<li>能实现的功能也很简单，只是简单的调取和返回 JSX 而已</li>
</ol>
</li>
<li><p>创建类式</p>
<ol>
<li>操作相对复杂一点，但是也可以实现更为复杂的业务功能</li>
<li>能够使用生命周期函数操作业务</li>
<li>函数式可以理解为静态组件（组件中的内容调取的时候就已经固定了，而类这种方式可以基于组件内部的状态来动态更新渲染的内容</li>
<li>。。。</li>
</ol>
</li>
</ul>
<h3 id="组件中的属性管理"><a href="#组件中的属性管理" class="headerlink" title="组件中的属性管理"></a>组件中的属性管理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/Dialog</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dialog</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// this.props 是只读的，我们无法在方法中修改它的值，但是可以给其默认值或者设置一些规则（例如：设置是否是必须传递的以及传递值的类型等）</span></span><br><span class="line">	<span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    lx: <span class="string">'系统提示'</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// prop-types 是facebook公司开发的一个插件，基于这个插件可以给组件传递的属性设置规则（设置的规则不会影响页面的渲染，但是会在控制台抛出警告错误）</span></span><br><span class="line">	<span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    <span class="comment">// con: PropTypes.string //=&gt; 传递的内容需要是字符串</span></span><br><span class="line">    con: PropTypes.string.isRequired <span class="comment">//=&gt; 不仅传递的内容需要是字符串，并且还必须传递</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 第一次渲染之前</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="comment">//=&gt; this.props.con = '嘿嘿嘿'; //=&gt; Cannot assign to read only property 'con' of object 组件中的属性是调取组件的时候（创建类实例的时候）传递给组件的信息，而这部分信息是“只读”的（只能获取不能修改）=&gt; “组件的属性（props）是只读的”</span></span><br><span class="line">    <span class="keyword">let</span> &#123;lx, con&#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">     	//=&gt; 设置默认值</span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;lx || '系统提示'&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;con&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	edsyang	                </span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">lx</span>=<span class="string">&#123;</span>'系统提示'&#125; <span class="attr">con</span>=<span class="string">"嘿嘿嘿"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h3 id="组件中的状态"><a href="#组件中的状态" class="headerlink" title="组件中的状态"></a>组件中的状态</h3><h4 id="状态-amp-属性"><a href="#状态-amp-属性" class="headerlink" title="状态 &amp; 属性"></a>状态 &amp; 属性</h4><p>React 中的组件有两个非常重要的概念</p>
<ol>
<li>组件的属性(props)：[只读]调取组件的时候（外界）传递进来的信息（默认属性，属性校验）<ul>
<li>默认属性：<code>static defaultProps</code></li>
<li>属性校验：<code>static propTypes</code></li>
</ul>
</li>
<li>组件的状态(state)：[读写]自己在组件中设定和规定的（只有类声明式组件才有状态的管控，函数式声明不存在状态的管理），改变状态唯一的方式就是 setState</li>
<li>注意：属性和状态的变化都会影响视图更新</li>
</ol>
<blockquote>
<ul>
<li>组件状态类似于 Vue 中的数据驱动：数据绑定的时候是基于状态值绑定，当修改组件状态后，对应的 JSX 元素也会跟着重新渲染（差异渲染：只把数据改变的部分重新渲染，基于 DOM-DIFF 算法完成）MVC(model, view, control)：数据影响视图</li>
<li>当代前端框架最重要的核心思想就是：“数据操控视图（视图影响数据）”，让我们告别 JQuery 手动操作 DOM 的时代，我们以后只需要改变数据，框架会帮我们重新渲染视图，从而减少直接操作 DOM（提高性能，也有助于开发效率）</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数式组件声明</span></span><br><span class="line"><span class="comment">// 所谓函数式组件是静态组件：和执行普通函数一样，调取一次组件，就把组件中的内容获取到，插入到页面中，如果不重新调取组件，现实的内容是不会发生任何改变的</span></span><br><span class="line"><span class="comment">// 真实项目中只有调取组件，组件中的内容不会再次改变的情况下，才可能使用函数式组件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Clock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">  	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前北京时间为：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  	&lt;div style=&#123;&#123;color: 'red', fontWeight: 'blod'&#125;&#125;&gt;</span><br><span class="line">      &#123;new Date().toLocalString()&#125;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; 每间隔1000ms重新调取组件，然后渲染到页面中</span></span><br><span class="line">	ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span></span>, root)  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类声明</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="comment">//=&gt; 初始化组件的状态(都是对象类型的)：要求我们在 constructor 中需要把后期使用的状态信息全部初始化一下（约定俗成的语法规范）</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      time: <span class="keyword">new</span> <span class="built_in">Date</span>().toLocalString()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="comment">//=&gt; React生命周期函数之一：第一次组件渲染完成后触发（我们在这里只需要间隔1000ms把state状态中的time数据改变，这样React会自动帮我们把组件中的部分内容进行重新渲染）</span></span><br><span class="line">    setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//=&gt; React中虽然下面方式可以修改状态，但是并不会通知React重新渲染页面，所以不要去这样操作和修改状态</span></span><br><span class="line">      <span class="comment">// this.state.time = new Date().toLocalString();</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * 修改组件的状态</span></span><br><span class="line"><span class="comment">       *    1. 修改部分状态：会用我们传递的对象和初始化的state进行匹配，只把我们传递的属性进行修改，没有传递的依然保留原始的状态信息（部分状态修改）</span></span><br><span class="line"><span class="comment">       *		2. 当状态修改完成，会通知 React 把组件 JSX 中的部分元素进行重新渲染</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        time: <span class="keyword">new</span> <span class="built_in">Date</span>().toLocalString()</span><br><span class="line">      &#125;, () =&gt; &#123;</span><br><span class="line">        <span class="comment">//=&gt; 当通知 React 把需要重新渲染的 JSX 元素渲染完成后，执行的回调操作（类似于生命周期函数中的componentDidUpdate，项目中一般使用钩子函数而不是这个回调）</span></span><br><span class="line">        <span class="comment">//=&gt; 设置回调函数的原因：setState 是异步操作，如果需要把异步的setState变成同步的，加async/await</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>当前北京时间为：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  		&lt;div style=&#123;&#123;color: 'red', fontWeight: 'blod'&#125;&#125;&gt;</span><br><span class="line">        &#123;/*获取组件的状态信息*/&#125;</span><br><span class="line">      	&#123;this.state.time&#125;</span><br><span class="line"><span class="xml">    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Clock</span> /&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h3 id="案例：投票"><a href="#案例：投票" class="headerlink" title="案例：投票"></a>案例：投票</h3><h4 id="数据驱动思想"><a href="#数据驱动思想" class="headerlink" title="数据驱动思想"></a>数据驱动思想</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vote</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; 组件传递的属性是只读的，为其设置默认值和相关规则</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;&#125;;</span><br><span class="line">	<span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    title: PropTypes.string.isRequired</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">//=&gt; init state</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      support: <span class="number">0</span>,</span><br><span class="line">      anti: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * support(e) &#123;</span></span><br><span class="line"><span class="comment">	 * 		//=&gt; this：undefined（不是我们理解的当前操作的元素）</span></span><br><span class="line"><span class="comment">	 *		//=&gt; e.target：通过事件源可以获取当前操作的元素（一般很少操作，因为框架主要是数据驱动所有DOM的改变）</span></span><br><span class="line"><span class="comment">	 *		//=&gt; 也可以在外面通过：this.support.bind(this)</span></span><br><span class="line"><span class="comment">	 *    //=&gt; 还可以通过（真实项目中，给JSX元素绑定的事件方法一般都是箭头函数，目的是为了保证函数中的this还是实例）：箭头函数 support = (e) =&gt; &#123;this&#125;</span></span><br><span class="line"><span class="comment">	 * &#125;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	support = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123;<span class="attr">support</span>: <span class="keyword">this</span>.state.support + <span class="number">1</span>&#125;)</span><br><span class="line">	anti = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123;<span class="attr">anti</span>: <span class="keyword">this</span>.state.anti + <span class="number">1</span>&#125;);</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;support, anti&#125; = <span class="keyword">this</span>.state,</span><br><span class="line">        supportRating = (support + anti) === <span class="number">0</span> ? <span class="string">'0%'</span> : ((support / (support + anti) * <span class="number">100</span>).toFixed(<span class="number">2</span>) + <span class="string">'%'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">60</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line">      &lt;div className='panel-heading'&gt;</span><br><span class="line">        &lt;h3 className='panel-title'&gt;&#123;this.props.title&#125;&lt;/h3&gt;</span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-body'&gt;</span><br><span class="line">      	支持人数：&#123;support&#125;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	反对人数：&#123;anti&#125;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	支持率：&#123;supportRating&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-footer'&gt;</span><br><span class="line">      	&lt;button className='btn btn-success' onClick=&#123;this.support&#125;&gt;支持&lt;/button&gt;</span><br><span class="line">    		&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    		&lt;button className='btn btn-danger' onClick=&#123;this.anti&#125;&gt;反对&lt;/button&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Vote</span> <span class="attr">title</span>=<span class="string">'吃了么'</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h4 id="DOM操作思想（ref）"><a href="#DOM操作思想（ref）" class="headerlink" title="DOM操作思想（ref）"></a>DOM操作思想（ref）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vote</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;&#125;;</span><br><span class="line">	<span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    title: PropTypes.string.isRequired</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//============================================//</span></span><br><span class="line">  <span class="comment">// ref写法1</span></span><br><span class="line">	support = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  	<span class="comment">// Refs: 是React中专门提供通过操作DOM来实现需求的方式，它是一个对象，存储了当前组件中所有设置Ref属性的元素（元素Ref属性值是什么，Refs中存储的元素的属性名就是什么）</span></span><br><span class="line">    <span class="comment">// console.log(this.refs);</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   spanLeft: span</span></span><br><span class="line">    <span class="comment">//   ...</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">let</span> &#123;spanLeft&#125; = <span class="keyword">this</span>.refs;</span><br><span class="line">    spanLeft.innerHTML++;</span><br><span class="line">    <span class="keyword">this</span>.computed();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  anti = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;spanRight&#125; = <span class="keyword">this</span>.refs;</span><br><span class="line">    spanRight.innerHTML++;</span><br><span class="line">    <span class="keyword">this</span>.computed();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  computed = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;spanLeft, spanRight, spanRate&#125; = <span class="keyword">this</span>.refs,</span><br><span class="line">        support = <span class="built_in">parseFloat</span>(spanLeft.innerHTML),</span><br><span class="line">        anti = <span class="built_in">parseFloat</span>(spanRight.innerHTML),</span><br><span class="line">        supportRating = (support + anti) === <span class="number">0</span> ? <span class="string">'0%'</span> : ((support / (support + anti) * <span class="number">100</span>).toFixed(<span class="number">2</span>) + <span class="string">'%'</span>);</span><br><span class="line">    spanRate.innerHTML = supportRating;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">60</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line">      &lt;div className='panel-heading'&gt;</span><br><span class="line">        &lt;h3 className='panel-title'&gt;&#123;this.props.title&#125;&lt;/h3&gt;</span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-body'&gt;</span><br><span class="line">      	支持人数：&lt;span ref='spanLeft'&gt;0&lt;/span&gt;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	反对人数：&lt;span ref='spanRight'&gt;0&lt;/span&gt;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	支持率：&lt;span ref='spanRate'&gt;0&lt;/span&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-footer'&gt;</span><br><span class="line">      	&lt;button className='btn btn-success' onClick=&#123;this.support&#125;&gt;支持&lt;/button&gt;</span><br><span class="line">    		&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    		&lt;button className='btn btn-danger' onClick=&#123;this.anti&#125;&gt;反对&lt;/button&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//============================================//</span></span><br><span class="line">  <span class="comment">// ref写法2</span></span><br><span class="line">	support = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;spanLeft&#125; = <span class="keyword">this</span>;</span><br><span class="line">    spanLeft.innerHTML++;</span><br><span class="line">    <span class="keyword">this</span>.computed();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  anti = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;spanRight&#125; = <span class="keyword">this</span>;</span><br><span class="line">    spanRight.innerHTML++;</span><br><span class="line">    <span class="keyword">this</span>.computed();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  computed = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;spanLeft, spanRight, spanRate&#125; = <span class="keyword">this</span>,</span><br><span class="line">        support = <span class="built_in">parseFloat</span>(spanLeft.innerHTML),</span><br><span class="line">        anti = <span class="built_in">parseFloat</span>(spanRight.innerHTML),</span><br><span class="line">        supportRating = (support + anti) === <span class="number">0</span> ? <span class="string">'0%'</span> : ((support / (support + anti) * <span class="number">100</span>).toFixed(<span class="number">2</span>) + <span class="string">'%'</span>);</span><br><span class="line">    spanRate.innerHTML = supportRating;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">60</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line">      &lt;div className='panel-heading'&gt;</span><br><span class="line">        &lt;h3 className='panel-title'&gt;&#123;this.props.title&#125;&lt;/h3&gt;</span><br><span class="line"><span class="xml">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-body'&gt;</span><br><span class="line">      	支持人数：&lt;span ref=&#123;x =&gt; this.spanLeft = x&#125;&gt;0&lt;/span&gt;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	反对人数：&lt;span ref=&#123;x =&gt; this.spanRight = x&#125;&gt;0&lt;/span&gt;</span><br><span class="line">    		&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">      	支持率：&lt;span ref=&#123;x =&gt; this.spanRate = x&#125;&gt;0%&lt;/span&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-footer'&gt;</span><br><span class="line">      	&lt;button className='btn btn-success' onClick=&#123;this.support&#125;&gt;支持&lt;/button&gt;</span><br><span class="line">    		&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    		&lt;button className='btn btn-danger' onClick=&#123;this.anti&#125;&gt;反对&lt;/button&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//============================================//</span></span><br><span class="line">&#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* ref='spanLeft'</span></span><br><span class="line"><span class="comment">	* 	是在当期实例上挂载一个属性refs（对象），存储所有的ref元素</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* x =&gt; this.spanLeft = x</span></span><br><span class="line"><span class="comment">	*		x代表当前元素，他的意思是，把当前元素直接挂在到实例上，后期需要用到元素，直接this.spanLeft获取即可		</span></span><br><span class="line"><span class="comment">	*/</span>&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Vote</span> <span class="attr">title</span>=<span class="string">'吃了么'</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h3 id="总结（受控组件-state-props-和非受控组件-ref-）"><a href="#总结（受控组件-state-props-和非受控组件-ref-）" class="headerlink" title="总结（受控组件[state, props]和非受控组件[ref]）"></a>总结（受控组件[state, props]和非受控组件[ref]）</h3><p>在 React 组件中</p>
<ol>
<li><p>基于数据驱动（修改状态数据，React 帮助我们重新渲染视图）完成的组件叫做“受控组件（受数据控制的组件）”，受控组件中必须要有 onChange 事件，否则不能使用</p>
</li>
<li><p>基于 Ref 操作 DOM 实现视图更新的，叫做“非受控组件”</p>
</li>
</ol>
<blockquote>
<p>真实项目中 / 官方建议，多使用“受控组件”</p>
</blockquote>
<h2 id="4-复合组件和单项数据流传递"><a href="#4-复合组件和单项数据流传递" class="headerlink" title="4. 复合组件和单项数据流传递"></a>4. 复合组件和单项数据流传递</h2><h3 id="基于表单元素的-onChange-实现-MVVM-双向绑定"><a href="#基于表单元素的-onChange-实现-MVVM-双向绑定" class="headerlink" title="基于表单元素的 onChange 实现 MVVM 双向绑定"></a>基于表单元素的 onChange 实现 MVVM 双向绑定</h3><ul>
<li><p>Vue：[MVVM] 数据更改视图跟着更改，视图更改数据也跟着更改（双向数据绑定）</p>
</li>
<li><p>React：[MVC] 数据更改视图跟着更改（原本是单向数据绑定，但可以自己构建出双向的效果）</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      text: <span class="string">'Edsyang'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;text&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span>&gt;</span></span></span><br><span class="line">    	&lt;div className='panel-heading'&gt;</span><br><span class="line">      	&lt;input type='text' </span><br><span class="line">            	 className='form-control' </span><br><span class="line">             	 value=&#123;text&#125; </span><br><span class="line">  						 onChange=&#123;(e) =&gt; &#123;</span><br><span class="line">      				 		this.setState(&#123;</span><br><span class="line">                    //=&gt; 在文本框的onChange中修改状态信息，实现的是视图改变数据</span><br><span class="line">                    text: e.target.value</span><br><span class="line">                  &#125;)</span><br><span class="line">    					 &#125;&#125;/&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span>   </span></span><br><span class="line">      &lt;div className='panel-body'&gt;</span><br><span class="line">      	&#123;text&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Temp</span> /&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h3 id="复合组件信息传递（一）"><a href="#复合组件信息传递（一）" class="headerlink" title="复合组件信息传递（一）"></a>复合组件信息传递（一）</h3><ul>
<li>父组件把信息传递给子组件<ul>
<li>基于属性传递即可（而且传递是单方向的：只能父亲通过属性把信息给儿子，儿子不能直接把信息作为属性传递给父亲）</li>
<li>后期子组件中的信息需要更改：可以让父组件传递给子组件的信息发生变化（也就是子组件接受的属性发生变化，子组件会重新渲染 =&gt; componrntWillReceiveProps 钩子函数）</li>
</ul>
</li>
<li>类似于“子改父”的操作，需要使用以下技巧完成<ol>
<li>把父组件中的一个方法，作为属性传递给子组件</li>
<li>在子组件中，把基于属性传递进来的方法，在合适的时候执行（相当于在执行父组件中的方法：而这个方法中完全可以操作父组件中的信息）</li>
</ol>
</li>
<li>平行（兄弟）组件之间的信息传递<ul>
<li>共同拥有一个父组件</li>
<li>redux / react-redux</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*HEAD*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Head</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'panel-heading'</span>&gt;</span></span></span><br><span class="line">			&lt;h3 className='panel-title'&gt;</span><br><span class="line">        &#123;/*子组件通过属性获取父组件传递的内容*/&#125;</span><br><span class="line">      	点击次数：&#123;this.props.count&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*BODY*/</span></span><br><span class="line"><span class="comment">//=&gt; 只要实现：**点击子组件 body 中按钮的时候，修改父组件 panel 的状态信息（n）**，panel 会重新执行 render 渲染，而重新执行 render 的时候，会把最新的状态值作为属性，传递给子组件的 head，head 接受的属性值发生改变，head 组件也会重新渲染</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Body</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'panel-body'</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">'btn btn-success'</span> <span class="attr">onClick</span>=<span class="string">&#123;this.props.callBack&#125;</span>&gt;</span>点我啊！<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*PANEL*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Panel</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      n: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//=&gt; 修改PANEL的状态信息</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      n: <span class="keyword">this</span>.state.n + <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">50</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/*父组件在调取子组件的时候，把信息通过属性传递给子组件*/&#125;</span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">Head</span> <span class="attr">count</span>=<span class="string">&#123;this.state.n&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Body</span> <span class="attr">callBack</span>=<span class="string">&#123;this.fn&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Panel</span> /&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<h4 id="封装轮播图"><a href="#封装轮播图" class="headerlink" title="封装轮播图"></a>封装轮播图</h4><p>轮播图实现原理</p>
<ul>
<li>container 是展示容器，wrapper 是图片的容器（所有图片）</li>
<li>wrapper的宽度取决于：展示图片的数量</li>
</ul>
<blockquote>
<p>轮播图切换其实就是控制 wrapper 的 left 值变化，切换到哪一张，就更改对应的 left 值即可</p>
<p>Left: -index * width </p>
<p>为了实现无缝衔接，把真实的第一张克隆到末尾，把真实的最后一张克隆到开始位置（三张真实，五个li）-&gt; <code>0第三张  1第一张  2第二张  3第三张  4第一张</code></p>
<ul>
<li>焦点对齐</li>
</ul>
<p>图片索引      0(第三张)      1(第一张)      2(第二张)      3(第三张)      4(第一张)</p>
<p>焦点索引      0                     1                     2</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/Banner.js //</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'../static/css/banner.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Banner</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps =&#123;</span><br><span class="line">    data: [],</span><br><span class="line">    interval: <span class="number">3000</span>,</span><br><span class="line">    step: <span class="number">1</span>,</span><br><span class="line">    speed: <span class="number">300</span></span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    data: PropTypes.array,</span><br><span class="line">    interval: PropTypes.number,</span><br><span class="line">    step: PropTypes.number,</span><br><span class="line">    speed: PropTypes.number</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">//=&gt; init state </span></span><br><span class="line">    <span class="keyword">let</span> &#123;step, speed&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      step,</span><br><span class="line">      speed</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">//=&gt; 数据的克隆</span></span><br><span class="line">	componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;data&#125; = <span class="keyword">this</span>.props,</span><br><span class="line">        cloneData = data.slice(<span class="number">0</span>);</span><br><span class="line">    cloneData.push(data[<span class="number">0</span>]);</span><br><span class="line">    cloneData.unshift(data[data.length - <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">this</span>.cloneData = cloneData; <span class="comment">//=&gt; 挂载到实例上供其他方法调用</span></span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">//=&gt; 自动轮播</span></span><br><span class="line">	componentWillMount() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 把定时器返回值挂载到实例上，方便后期清除：结束自动轮播</span></span><br><span class="line">    <span class="keyword">this</span>.autoTimer = setInterval(<span class="keyword">this</span>.autoMove, <span class="keyword">this</span>.props.interval);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">		<span class="keyword">let</span> &#123;data&#125; = <span class="keyword">this</span>.props,</span><br><span class="line">        &#123;cloneData&#125; = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (data.length === <span class="number">0</span>) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    <span class="comment">//=&gt; 控制wrapper样式</span></span><br><span class="line">    <span class="keyword">let</span> &#123;step, speed&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">let</span> wrapperSty = &#123;</span><br><span class="line">      width: cloneData.length * <span class="number">1000</span> + <span class="string">'px'</span>,</span><br><span class="line">      left: -step * <span class="number">1000</span> + <span class="string">'px'</span>,</span><br><span class="line">      transition: <span class="string">`left <span class="subst">$&#123;speed&#125;</span>ms linear 0ms`</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'container'</span>&gt;</span></span></span><br><span class="line">			&lt;ul className='wrapper'&gt;</span><br><span class="line">      	&#123;cloneData.map((item, index) =&gt; &#123;</span><br><span class="line">      		let &#123;title, pic&#125; = item;</span><br><span class="line">      		return &lt;li key=&#123;index&#125;&gt;</span><br><span class="line">            &lt;img src=&#123;pic&#125; alt=&#123;title&#125;/&gt;</span><br><span class="line">          &lt;/li&gt;;</span><br><span class="line">    		&#125;)&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">			&lt;ul className='focus'&gt;</span><br><span class="line">      	&#123;data.map((item, index) =&gt; &#123;</span><br><span class="line">          let tempIndex = step - 1;</span><br><span class="line">          step === 0 ? tempIndex = data.length - 1 : null;</span><br><span class="line">          step === cloneData.length - 1 ? tempIndex = 0 : null;</span><br><span class="line">      		return &lt;li key=&#123;index&#125; </span><br><span class="line">          					 className=&#123;tempIndex === index ? 'active' : ''&#125;&gt;&lt;/li&gt;;</span><br><span class="line">    		&#125;)&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">className</span>=<span class="string">'arrow arrowLeft'</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">className</span>=<span class="string">'arrow arrowRight'</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="comment">//=&gt; 边界判断：如果最新修改的step索引大于最大索引（说明此事已经是末尾了，不能再向后走了），我们让其立即回到（无动画）索引为1的位置</span></span><br><span class="line">    <span class="keyword">if</span> (nextState.step &gt; <span class="keyword">this</span>.cloneData.length - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        step: <span class="number">1</span>,</span><br><span class="line">        speed: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">	componentDidUpdate() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 只有是从克隆的第一张立即切换到真实第一张后，我们才做以下处理：让其从当前第一张运动到第二张即可</span></span><br><span class="line">		<span class="keyword">let</span> &#123;step, speed&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">if</span> (step === <span class="number">1</span> &amp;&amp; speed === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//=&gt; 为什么要设置定时器延迟：CSS3 的 transition 有一个问题（主栈执行的时候，短时间内遇到两次设置 transition-duration 的代码，以最后一次设置的为主</span></span><br><span class="line">      <span class="keyword">let</span> delayTimer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        clearTimeout(delayTimer)</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        	step: step + <span class="number">1</span>,</span><br><span class="line">        	speed: <span class="keyword">this</span>.props.speed</span><br><span class="line">      	&#125;);</span><br><span class="line">      &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//=&gt; 向右切换</span></span><br><span class="line">  autoMove = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      step: <span class="keyword">this</span>.state.step + <span class="number">1</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js //</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Banner <span class="keyword">from</span> <span class="string">'./component/Banner'</span>;</span><br><span class="line"><span class="comment">//=&gt; 公共的样式资源在 index 中导入（组件独有的样式可以在组件内部导入）</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./static/css/reset.min.css'</span>;</span><br><span class="line"><span class="comment">//=&gt; 在 react 的 JSX 中需要使用图片等资源的时候，资源的地址不能使用相对地址（因为经过webpack编译后，资源地址的路径已经改变了，原有的相对地址无法找到对应的资源），此时我们需要基于ES6 Module或者CommonJS等模块导入规范，把资源当作模块导入进来（或者我们使用的图片地址都是网络地址）</span></span><br><span class="line"><span class="keyword">let</span> IMG_DATA = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">  IMG_DATA.push(&#123;</span><br><span class="line">    id: i,</span><br><span class="line">    title: <span class="string">''</span>,</span><br><span class="line">    pic: <span class="built_in">require</span>(<span class="string">`./static/images/<span class="subst">$&#123;i&#125;</span>.jpg`</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=&gt; 调取组件渲染</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	/*</span></span><br><span class="line"><span class="xml">	 * data: 轮播图需要绑定的数据（default：空数组）</span></span><br><span class="line"><span class="xml">	 * interval：自动轮播间隔的时间（default：3000ms）</span></span><br><span class="line"><span class="xml">	 * step：默认展示图片的索引（default：记住前后各克隆了一张 1）</span></span><br><span class="line"><span class="xml">	 * speed：每一张切换所需要的运动时间（default：300ms）</span></span><br><span class="line"><span class="xml">	 */                </span></span><br><span class="line">	&lt;Banner data=&#123;IMG_DATA&#125; </span><br><span class="line">					interval=&#123;3000&#125; </span><br><span class="line">					step=&#123;1&#125; </span><br><span class="line"><span class="xml">					speed=&#123;300&#125;/&gt;</span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>            </span></span><br><span class="line">	&lt;Banner data=&#123;IMG_DATA.slice(1)&#125; </span><br><span class="line">					interval=&#123;5000&#125; </span><br><span class="line"><span class="xml">					step=&#123;3&#125; /&gt;            </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h3 id="复合组件信息传递（二）"><a href="#复合组件信息传递（二）" class="headerlink" title="复合组件信息传递（二）"></a>复合组件信息传递（二）</h3><ol>
<li><p>复合组件：父组件嵌套子组件</p>
<ul>
<li><p>【传递信息的方式】</p>
<ul>
<li><p>[父组件需要把信息传递给子组件]</p>
<ul>
<li><p>“属性（props）传递”：调取子组件的时候，把信息基于属性的方式传递给子组件（子组件 props 中存储传递的信息）；这种方式只能父组件把信息传递子组件，子组件无法直接的把信息传递给父组件，也就是属性传递信息是单向传递的；</p>
</li>
<li><p>“上下文（context）传递”：父组件先把需要给后代元素（包括孙子元素）使用的信息都设置好（设置在上下文中），后代组件需要用到父组件中的信息，主动去父组件中调取使用即可</p>
</li>
<li><pre><code class="js"><span class="comment">//=&gt; 父组件设置信息</span>
<span class="keyword">static</span> childContextTypes = {
  <span class="comment">//=&gt; 设置上下文中信息值的类型</span>
  n: PropTypes.number,
  m: PropTypes.number
};
getChildContext() {
  <span class="comment">//=&gt; return 的是什么，相当于给子组件上下文设置了什么</span>
  <span class="keyword">let</span> {<span class="attr">count</span>: {n = <span class="number">0</span>, m = <span class="number">0</span>}} = <span class="keyword">this</span>.props;
  <span class="keyword">return</span> { n, m };
};

<span class="comment">//=&gt; 子组件主动获取需要的信息</span>
<span class="keyword">static</span> contextTypes = {
  <span class="comment">//=&gt; 首先类型需要和设置的时候类型一样，否则报错；并且你需要用什么，就写什么即可</span>
  n: PropTypes.number,
  m: PropTypes.number
};
&lt;!--￼<span class="number">21</span>--&gt;
父：Parent
</code></pre>
</li>
</ul>
<p>子：A / B</p>
<p>父组件中有一些信息，父组件把一个方法传递给 A，A中把方法执行（方法执行修改父组件信息值），父组件再把最新的信息传递给 B 即可，等价于 A 操作，影响了 B</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- [方案二：基于 redux 来进行状态管理，实现组件之间的信息传输（常用方案）]</span><br></pre></td></tr></table></figure>
<p>redux 可以应用在任何的项目中（vue / jQ / react 的都可以），react-redux 才是专门给 react 项目提供的方案</p>
<p>统一管理状态的容器（每个组件中都可以操作这个容器）：当容器中的信息发生改变，可以通知所有用到的状态信息的逐渐重新渲染【“发布订阅”】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">&#x2F;&#x2F; 自己写一个比较low的redux</span><br><span class="line">&#x2F;&#x2F;&#x3D;&gt; 全局下挂载一个容器来实现信息共享和通信</span><br><span class="line">let myRedux &#x3D; (function anonymous() &#123;</span><br><span class="line">	let stateObj &#x3D; [], &#x2F;&#x2F; 存放所有的管理状态</span><br><span class="line">      listenAry &#x3D; [] &#x2F;&#x2F; 存放所有状态改变时需要做的事情</span><br><span class="line">	function updateState(callback) &#123;</span><br><span class="line">		&#x2F;&#x2F;&#x3D;&gt; callback: 回调函数中一定是修改并且返回最新的状态信息的，用返回的状态信息替换原有的状态信息</span><br><span class="line">		let newObj &#x3D; callback(stateObj);</span><br><span class="line">		stateObj &#x3D; &#123;...stateObj, ...newObj&#125;;</span><br><span class="line">		&#x2F;&#x2F;&#x3D;&gt; 当状态更改：通知计划表中的方法执行</span><br><span class="line">		listenAry.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">			if (typeof item &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;</span><br><span class="line">				item();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;); </span><br><span class="line">	&#125;</span><br><span class="line">	function getState() &#123;</span><br><span class="line">		return stateObj;</span><br><span class="line">	&#125;</span><br><span class="line">	function subscribe(fn) &#123;</span><br><span class="line">		for (let i &#x3D; 0; i &lt; listenAry.length; i++) &#123;</span><br><span class="line">			let item &#x3D; listenAry[i];</span><br><span class="line">			if (item &#x3D;&#x3D;&#x3D; fn) &#123;</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		listenAry.push(fn);</span><br><span class="line">	&#125;</span><br><span class="line">	return &#123;</span><br><span class="line">		updateState, &#x2F;&#x2F; 修改状态中的信息，信息一旦被修改就会通知 listenAry 中的方法执行</span><br><span class="line">		getState, &#x2F;&#x2F; 拿到状态中最新的信息</span><br><span class="line">		subscribe &#x2F;&#x2F; 向事件池中增加方法</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>直接修改容器中的状态信息是一个不好的操作：把状态改了（任何组件都可以直接修改），以后获取的状态信息一旦不是我们想要的，都不知道在哪儿修改的，不方便项目的维护</p>
<p><strong>更好的方案：带管理员reducer的统一状态管理 =&gt; redux的核心思想所在</strong>     </p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="复合组件案例"><a href="#复合组件案例" class="headerlink" title="复合组件案例"></a>复合组件案例</h4><p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Vote <span class="keyword">from</span> <span class="string">'./component/Vote/Vote'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	&#123;/*title: 标题  count：初始支持反对人数*/&#125;</span></span><br><span class="line">	&lt;Vote title=&#123;'睡了么'&#125; </span><br><span class="line">			  count=&#123;&#123;</span><br><span class="line">               n: 100,</span><br><span class="line">               m: 78</span><br><span class="line"><span class="xml">  			&#125;&#125;/&gt;      </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<p>component/Vote/Vote.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteHead <span class="keyword">from</span> <span class="string">'./VoteHead'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteBody <span class="keyword">from</span> <span class="string">'./VoteBody'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteFooter <span class="keyword">from</span> <span class="string">'./VoteFooter'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Vote</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; props</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    title: <span class="string">'吃了么？'</span>,</span><br><span class="line">    count: &#123;</span><br><span class="line">      n: <span class="number">0</span>,</span><br><span class="line">      m: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">	<span class="comment">//=&gt; context</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 *	在父组件中</span></span><br><span class="line"><span class="comment">	 *		需要安装：prop-types</span></span><br><span class="line"><span class="comment">	 *		1. 设置子组件上下文属性值类型</span></span><br><span class="line"><span class="comment">	 *			 static childContextTypes = &#123;&#125;</span></span><br><span class="line"><span class="comment">	 *		2. 获取子组件的上下文（设置子组件的上下文属性信息）</span></span><br><span class="line"><span class="comment">	 *			 getChildContext() &#123; return &#123;&#125; &#125;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">    n: PropTypes.number,</span><br><span class="line">    m: PropTypes.number,</span><br><span class="line">    callBack: propTypes.func</span><br><span class="line">  &#125;;</span><br><span class="line">	getChildContext() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 只要render重新渲染，就会执行这个方法，重新更新父组件中的上下文信息；如果父组件上下文信息更改了，子组件在重新调取的时候，会使用最新的上下文信息；（render-&gt;context-&gt; 子组件调取渲染）</span></span><br><span class="line">    <span class="comment">//=&gt; return 的是什么，相当于给子组件上下文设置了什么</span></span><br><span class="line">    <span class="comment">// let &#123;n = 0, m = 0&#125; = this.state;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// n,</span></span><br><span class="line">      <span class="comment">// m,</span></span><br><span class="line">      callBack: <span class="keyword">this</span>.updateContext</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  updateContext = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//=&gt; type: 'support' / 'against'</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'support'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">n</span>: <span class="keyword">this</span>.state.n + <span class="number">1</span>&#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">m</span>: <span class="keyword">this</span>.state.m + <span class="number">1</span>&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">//=&gt; init state</span></span><br><span class="line">    <span class="keyword">let</span> &#123;<span class="attr">count</span>: &#123;n = <span class="number">0</span>, m = <span class="number">0</span>&#125;&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;n, m&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;title&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel</span> <span class="attr">panel-default</span>'&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">50</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">VoteHead</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">VoteBody</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">VoteFooter</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteHead.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteHead</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-heading</span>'&#125;&gt;</span></span></span><br><span class="line">			&lt;h3 className=&#123;'panel-title'&#125;&gt;</span><br><span class="line">      	&#123;this.props.title&#125;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteBody.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteBody</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   *	3. 子组件中设置使用传递进来的上下文类型：设置哪个类型，子组件上下文中才有哪个属性，不设置的是不允许使用的</span></span><br><span class="line"><span class="comment">   *		 this.context.xxx</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">   * 		 指定的上下文属性类型需要和父组件中指定的类型保持一致，否则报错</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">    n: PropTypes.number,</span><br><span class="line">    m: PropTypes.number</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;n, m&#125; = <span class="keyword">this</span>.context,</span><br><span class="line">        rete = (n / (n + m) * <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">isNaN</span>(rate) ? rate = <span class="number">0</span> : <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-body</span>'&#125;&gt;</span></span></span><br><span class="line"><span class="xml">			支持人数：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;n&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      反对人数：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;m&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      支持比例：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;rate.toFixed(2) + '%'&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteFooter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteFooter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">  	callBack: PropTypes.func</span><br><span class="line">	&#125;;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;callBack&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-footer</span>'&#125;&gt;</span></span></span><br><span class="line">			&lt;button className=&#123;'btn btn-success'&#125; onClick=&#123;() =&gt; &#123;</span><br><span class="line">        callBack('support')</span><br><span class="line"><span class="xml">      &#125;&#125;&gt;支持<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line">			&lt;button className=&#123;'btn btn-danger' onClick=&#123;() =&gt; &#123;</span><br><span class="line">        callBack('against')</span><br><span class="line"><span class="xml">      &#125;&#125;&gt;反对<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="平行组件案例"><a href="#平行组件案例" class="headerlink" title="平行组件案例"></a>平行组件案例</h4><p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Vote <span class="keyword">from</span> <span class="string">'./component/Vote/Vote'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'bootstrap/dist/css/bootstrap.css'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	&#123;/*title: 标题  count：初始支持反对人数*/&#125;</span></span><br><span class="line">	&lt;Vote title=&#123;'睡了么'&#125; </span><br><span class="line">			  count=&#123;&#123;</span><br><span class="line">               n: 100,</span><br><span class="line">               m: 78</span><br><span class="line"><span class="xml">  			&#125;&#125;/&gt;      </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<p>component/Vote/Vote.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteHead <span class="keyword">from</span> <span class="string">'./VoteHead'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteBody <span class="keyword">from</span> <span class="string">'./VoteBody'</span>;</span><br><span class="line"><span class="keyword">import</span> VoteFooter <span class="keyword">from</span> <span class="string">'./VoteFooter'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Vote</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; props</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    title: <span class="string">''</span>,</span><br><span class="line">    count: &#123;</span><br><span class="line">      n: <span class="number">0</span>,</span><br><span class="line">      m: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel</span> <span class="attr">panel-default</span>'&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> '<span class="attr">50</span>%', <span class="attr">margin:</span> '<span class="attr">20px</span> <span class="attr">auto</span>'&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">VoteHead</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">VoteBody</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">VoteFooter</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteHead.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteHead</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-heading</span>'&#125;&gt;</span></span></span><br><span class="line">			&lt;h3 className=&#123;'panel-title'&#125;&gt;</span><br><span class="line">      	</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteBody.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteBody</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-body</span>'&#125;&gt;</span></span></span><br><span class="line"><span class="xml">			支持人数：<span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      反对人数：<span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      支持比例：<span class="tag">&lt;<span class="name">span</span>&gt;</span>0.00%<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>component/Vote/VoteFooter.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteFooter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;callBack&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;</span>'<span class="attr">panel-footer</span>'&#125;&gt;</span></span></span><br><span class="line">			&lt;button className=&#123;'btn btn-success'&#125; onClick=&#123;() =&gt; &#123;</span><br><span class="line">        </span><br><span class="line"><span class="xml">      &#125;&#125;&gt;支持<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">			<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line">			&lt;button className=&#123;'btn btn-danger' onClick=&#123;() =&gt; &#123;</span><br><span class="line">        </span><br><span class="line"><span class="xml">      &#125;&#125;&gt;反对<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redux-amp-React-Redux"><a href="#Redux-amp-React-Redux" class="headerlink" title="Redux &amp; React-Redux"></a>Redux &amp; React-Redux</h3><h4 id="Redux-基础流程"><a href="#Redux-基础流程" class="headerlink" title="Redux 基础流程"></a>Redux 基础流程</h4><blockquote>
<p><strong>Redux：进行状态统一管理的类库（适用于任何技术体系的项目）</strong></p>
<ol>
<li><p>只要两个或者多个组件之间想要实现信息的共享，都可以基于 redux 解决，把共享的信息存储到 redux 容器中进行管理</p>
</li>
<li><p>（性能优化）还可以使用 redux 做临时存储：页面加载的时候，把从服务器获取的数据信息存储到 redux 中，组件渲染需要的数据，从 redux 中获取，这样只要页面不刷新，路由切换的时候，再次渲染组件不需要重新从服务器拉去数据，直接从 redux 中获取即可；页面刷新，从头开始！</p>
<blockquote>
<p>这套方法代替了 localStorage 本地存储来实现数据缓存</p>
</blockquote>
</li>
</ol>
</blockquote>
<ul>
<li><p>安装 Redux </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn add redux</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入 redux 并创建容器（store）：需要把 reducer 传递进来（登记了所有状态更改的信息）</p>
<ul>
<li>reducer 作用<ol>
<li>记录了所有状态修改信息（根据行为标示走不同的修改任务）</li>
<li>修改容器中的状态信息</li>
</ol>
</li>
<li>reducer 参数<ul>
<li>state：容器中原有的状态信息（如果第一次使用，没有原有状态，给一个初始默认值）</li>
<li>action：dispatch 任务派发的时候传递的行为（这个对象中必有一个 type 属性，是操作的行为标示，reducer 就是根据这个行为标示来识别该如何修改状态信息）</li>
</ul>
</li>
</ul>
<blockquote>
<p>创建的 store 中提供三个方法：</p>
<ul>
<li>dispatch：派发行为（传递一个对象，对象中有一个 type 属性），通知 reducer 修改状态信息</li>
<li>subscribe：事件池追加方法</li>
<li>getState：获取最新管理的状态信息</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建容器</span></span><br><span class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">let</span> initState = &#123;<span class="attr">n</span>: <span class="number">0</span>, <span class="attr">m</span>: <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> reducer = <span class="function">(<span class="params">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'VOTE_SUPPORT'</span>:</span><br><span class="line">      state = &#123;...state, <span class="attr">n</span>: state.n + <span class="number">1</span>&#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'VOTE_AGAINST'</span></span><br><span class="line">      state = &#123;...state, <span class="attr">m</span>: state.m + <span class="number">1</span>&#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">return</span> state; <span class="comment">// 只有把最新的 state 返回，原有的状态才会被修改</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, root)</span><br><span class="line"><span class="comment">// 修改 redux 中的信息的操作</span></span><br><span class="line">dispatch(&#123;</span><br><span class="line">  type: <span class="string">'VOTE_SUPPORT'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取 redux 中的信息的操作</span></span><br><span class="line">subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;n, m&#125; = getState();</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;n, m&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/images/frame/react/1.png" alt="image-20191031171748557"></p>
<h4 id="Redux-工程化结构"><a href="#Redux-工程化结构" class="headerlink" title="Redux 工程化结构"></a>Redux 工程化结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 目录 &#x2F;&#x2F;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">|___ store</span><br><span class="line">		|___ action【存放每一个模块需要进行的派发任务（ActionCreator）- 修改 redux 容器中的状态】</span><br><span class="line">				|___ xxx.js【每个版块单独的actionCreator：就是把 dispatch 派发时需要传递的 action 对象进一步统一封装处理（react-redux 中会体现出好处），在 dispatch 派发的时候需要传递什么就返回什么即可】</span><br><span class="line">				|___ ...</span><br><span class="line">				|___ index.js【所有模块的 action 进行合并（合并所有的actionCreator，类似于 reducer 合并，为了防止冲突，合并后的对象是以板块名称单独划分管理）】</span><br><span class="line">		|___ reducer【存放&#x2F;合并每一个模块的 reducer（一个 store 只能有一个 reducer）】</span><br><span class="line">				|___ xxx.js</span><br><span class="line">				|___ ...</span><br><span class="line">				|___ index.js【把每一个模块单独设定的 reducer 函数最后合并成为一个总的 reducer（使用 combineReducers）：为了保证合并 reducer 过程中，每个模块管理的状态信息不会相互冲突，redux 在合并的时候把容器中的状态进行分开管理（以合并 reducer 时候设置的属性名作为状态划分的属性名，把各个板块管理的状态放到自己的属性下即可）】</span><br><span class="line">		|___ action-types.js【所有派发任务的行为标示都在这里进行宏观管理（管控当前项目中所有 redux 任务派发中需要的行为标示 action-type）】</span><br><span class="line">		|___ index.js【创建 store】</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/reducer/xxx.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Types <span class="keyword">from</span> <span class="string">'../action-typs'</span>; <span class="comment">// 把模块中所有导出的内容全部导入并重新命名为 Types，此后 Types 对象中包含了所有导出的信息（ES6 Module）</span></span><br><span class="line"><span class="keyword">let</span> initState = &#123;<span class="attr">n</span>: <span class="number">0</span>, <span class="attr">m</span>: <span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">xxx</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// state: 原始 redux 管理的状态信息（设置初始值）</span></span><br><span class="line">	<span class="comment">// action: dispatch 派发的时候传递的行为对象（type,...）</span></span><br><span class="line">	<span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> Types.VOTE_SUPPORT:</span><br><span class="line">      state = &#123;...state, <span class="attr">n</span>: state.n + <span class="number">1</span>&#125;;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Types.VOTE_AGAINST:</span><br><span class="line">      state = &#123;...state, <span class="attr">m</span>: state.m + <span class="number">1</span>&#125;;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// store/reducer/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> vote <span class="keyword">from</span> <span class="string">'./vote'</span>;</span><br><span class="line"><span class="keyword">import</span> personal <span class="keyword">from</span> <span class="string">'./personal'</span>;</span><br><span class="line"><span class="keyword">let</span> reducer = combineReducers(&#123;</span><br><span class="line">  vote,</span><br><span class="line">  personal</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br><span class="line"><span class="comment">// 为了保证合并 reducer 过程中，每个模块管理的状态信息不会相互冲突，redux 在合并的时候把容器中的状态进行分开管理（以合并 reducer 时候设置的属性名作为状态划分的属性名，把各个板块管理的状态放到自己的属性下）</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * state = &#123;</span></span><br><span class="line"><span class="comment"> * 		vote: &#123;n: 0, m: 0&#125;,</span></span><br><span class="line"><span class="comment"> * 		personal: &#123;baseInfo: []&#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * store.getState().vote.n 以后获取状态信息的时候，也需要把 vote 等板块名加上</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// store/action/xxx.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Types <span class="keyword">from</span> <span class="string">'../action-typs'</span>;</span><br><span class="line"><span class="keyword">let</span> xxx = &#123;</span><br><span class="line">  support() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 在 dispatch 派发的时候需要传递什么就返回什么即可</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type: Types.VOTE_SUPPORT</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  against() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type: Types.VOTE_AGAINST</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// store/action/index.js</span></span><br><span class="line"><span class="keyword">import</span> vote <span class="keyword">from</span> <span class="string">'./vote'</span>;</span><br><span class="line"><span class="keyword">import</span> personal <span class="keyword">from</span> <span class="string">'./personal'</span>;</span><br><span class="line"><span class="keyword">let</span> action = &#123;</span><br><span class="line">  vote,</span><br><span class="line">  personal</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> action;</span><br><span class="line"><span class="comment">// 合并所有的actionCreator，类似于 reducer 合并，为了防止冲突，合并后的对象是以板块名称单独划分管理</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * action = &#123;</span></span><br><span class="line"><span class="comment"> * 		vote: &#123;xxx() &#123;&#125;, yyy() &#123;&#125;&#125;,</span></span><br><span class="line"><span class="comment"> *		personal: &#123;xxx() &#123;&#125;, yyy() &#123;&#125;&#125;</span></span><br><span class="line"><span class="comment"> *		...</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span>    </span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// component/派发任务</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">"../store/action"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteHandle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="built_in">console</span>.log(action.vote);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel-footer'</span>&gt;</span></span></span><br><span class="line">      &lt;button className="btn btn-success"</span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                this.props.store.dispatch(action.vote.support());</span><br><span class="line">              &#125;&#125;&gt;</span><br><span class="line">        支持</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line">      &lt;button className="btn btn-danger"</span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                this.props.store.dispatch(action.vote.against())</span><br><span class="line">              &#125;&#125;&gt;</span><br><span class="line">        反对</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// component/获取状态</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">'../store/action'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteBase</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="comment">// 真实项目中我们会把redux容器的状态信息获取到，赋值给组件的状态或者属性（react-redux），这么做的目的是；当redux中的改变状态，我们可以修改组件内部的状态，从而达到重新渲染组件的目的</span></span><br><span class="line">    <span class="keyword">let</span> reduxState = <span class="keyword">this</span>.props.store.getState().vote;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      ...reduxState, <span class="comment">// 包含title/n/m所有管理的属性</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在第一次加载执行，通过行为派发（VOTE_INIT）把 redux 中的信息赋值初始值</span></span><br><span class="line">  UNSAFE_componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.store.dispatch(action.vote.init(&#123;</span><br><span class="line">      title: <span class="string">'吃了么'</span>,</span><br><span class="line">      n: <span class="number">0</span>,</span><br><span class="line">      m: <span class="number">100</span></span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">let</span> reduxState = <span class="keyword">this</span>.props.store.getState().vote;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;...reduxState&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 向发布订阅事件池中追加一个方法，监听redux容器中状态改变，状态改变重新渲染组件</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> reduxState = <span class="keyword">this</span>.props.store.getState().vote;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;...reduxState&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &lt;div className='panel-heading'&gt;</span><br><span class="line">        &lt;h3 className='panel-title'&gt;</span><br><span class="line">          &#123;this.state.title&#125;</span><br><span class="line">        &lt;/h3&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &lt;div className="panel-body"&gt;</span><br><span class="line">        支持人数：&lt;span&gt;&#123;this.state.n&#125;&lt;/span&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        反对人数：&lt;span&gt;&#123;this.state.m&#125;&lt;/span&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        支持比例：&lt;span&gt;&#123;(this.state.n / (this.state.n + this.state.m) * 100).toFixed(2) + '%'&#125;&lt;/span&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">============================================================  </span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">Vote</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;/</span>&gt;</span> </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span>, root)</span><br></pre></td></tr></table></figure>

<h4 id="Redux-中间件"><a href="#Redux-中间件" class="headerlink" title="Redux 中间件"></a>Redux 中间件</h4><blockquote>
<p>redux 中间件不需要做任何处理，直接使用即可</p>
</blockquote>
<ul>
<li><p>安装中间件，常用中间件：redux-logger、redux-thunk、redux-promise</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn add redux-logger redux-thunk redux-promise</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入并使用中间件：使用 redux 中的 applyMiddleware 来调取中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createStore, applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reduxLogger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> reduxThunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> reduxPromise <span class="keyword">from</span> <span class="string">'redux-promise'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer, applyMiddleware(reduxLogger, reduxThunk, reduxPromise));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>redux-logger：能够在控制台清晰地展示出当前 redux 操作的流程和信息（原有状态、派发信息、修改后的状态信息）</p>
<ul>
<li>之前状态对、action 也对，但是之后的状态不对 =&gt; reducer 有问题</li>
<li>之前状态对、action 有问题 =&gt; 直接到 action 中找</li>
<li>容器状态更改成想要的，但页面展示最新的 =&gt; 绑定的时候有问题</li>
</ul>
</li>
<li><p>redux-thunk：处理异步的 dispatch 派发</p>
<ul>
<li>语法：返回一个函数，在函数中默认有一个 dispatch，执行 dispatch，在 dispatch 中执行异步派发任务</li>
<li>原理：所谓的异步就是先发个假的，把真正的/自己想处理的事情在指定时间处理</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Types <span class="keyword">from</span> <span class="string">'../action-types'</span>;</span><br><span class="line"><span class="comment">// 不使用中间件的正常情况【未使用 redux-thunk 时只能处理同步的操作，如果使用异步操作会报错】</span></span><br><span class="line"><span class="keyword">let</span> xxx = &#123;</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type: Types.XXX,</span><br><span class="line">      payload</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 redux-thunk 中间件处理后的</span></span><br><span class="line"><span class="keyword">let</span> xxx = &#123;</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">    <span class="comment">//=&gt; redux-thunk 中间件的使用语法：在指定执行派发任务的时候，等待3000ms后再派发</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//=&gt; dispatch 都传递给我们了，想什么时候派发，自己做即可</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">          type: Types.XXX,</span><br><span class="line">          payload</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, <span class="number">3000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>redux-promise：在 dispatch 派发的时候支持 promise 操作</p>
<ul>
<li>语法：reducer 的 payload 需要赋值一个 promise 实例，在 promise 实例中执行异步操作，当 promise 成功后，才会将结果传递，实现异步操作</li>
<li>原理：第一次发的就是真的，只不过传的值时 promsie，并没有改容器中的状态，而是等 promise 成功后再发送一次</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 redux-promise 处理异步</span></span><br><span class="line"><span class="comment">// promise 中间件的语法</span></span><br><span class="line"><span class="keyword">let</span> xxx = &#123;</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type: Types.XXX,</span><br><span class="line">      <span class="comment">//=&gt; 传递给 reducer 的 payload 需要等待 promise 成功，把成功的结果传递过去</span></span><br><span class="line">      payload: <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          resolve(payload);</span><br><span class="line">        &#125;, <span class="number">3000</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="中间件的实现"><a href="#中间件的实现" class="headerlink" title="中间件的实现"></a>中间件的实现</h4><p><strong>实现 redux-logger 中间件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> <span class="function"><span class="params">action</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(store.getState().number);</span><br><span class="line">  dispatch(action);</span><br><span class="line">  <span class="built_in">console</span>.log(store.getState().number)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> applyMiddleWare = <span class="function"><span class="params">middleware</span> =&gt;</span> <span class="function"><span class="params">createStore</span> =&gt;</span> <span class="function"><span class="params">reducer</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line">  <span class="keyword">let</span> middle = middleware(store);</span><br><span class="line">  <span class="keyword">let</span> dispatch = middle(store.dispatch);</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="comment">//将中间返回的dispatch方法覆盖掉原有store中的dispatch</span></span><br><span class="line">    ...store,</span><br><span class="line">    dispatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> applyMiddleWare(logger)(createStore)(reducer);</span><br></pre></td></tr></table></figure>

<p><strong>实现 redux-thunk 中间件：实现派发异步动作，actionCreator 可以返回函数，可以把dispatch 的权限交给此函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  add(amount)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch,getState</span>) </span>&#123;</span><br><span class="line">      dispatch(&#123;<span class="attr">type</span>:Types.ADD,amount&#125;);</span><br><span class="line">      dispatch(&#123;<span class="attr">type</span>:Types.ADD,amount&#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(getState().number);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  minus(amount)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>:Types.MINUS,amount&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">let</span> reduxThunk = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> <span class="function"><span class="params">action</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> action === <span class="string">'function'</span>)&#123; <span class="comment">//如果是函数将派发的权限传递给函数</span></span><br><span class="line">    <span class="keyword">return</span> action(dispatch,store.getState);</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(action);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>实现 redux-promise 中间件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action</span></span><br><span class="line">minus(amount)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      type:Types.MINUS,</span><br><span class="line">      payload:<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">        reject(&#123;<span class="attr">amount</span>:<span class="number">2</span>&#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//store/index.js</span></span><br><span class="line"><span class="keyword">let</span> reduxPromise = <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> <span class="function"><span class="params">action</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (action.then)&#123;</span><br><span class="line">    <span class="keyword">return</span> action.then(dispatch); <span class="comment">//只支持成功</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(action.payload &amp;&amp; action.payload.then)&#123;</span><br><span class="line">    <span class="comment">// 如果 payload 是一个 promise 会对成功和失败都进行捕获并且将成功或失败的数据放到payload 中进行派发</span></span><br><span class="line">    <span class="keyword">return</span> action.payload.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      dispatch(&#123;...action,<span class="attr">payload</span>:data&#125;);</span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      dispatch(&#123;...action,<span class="attr">payload</span>:data&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(action);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>实现 compose</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> applyMiddleWare = <span class="function">(<span class="params">...middlewares</span>) =&gt;</span> <span class="function"><span class="params">createStore</span> =&gt;</span> <span class="function"><span class="params">reducer</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line">  <span class="keyword">let</span> middles = middlewares.map(<span class="function"><span class="params">middleware</span>=&gt;</span>middleware(store))</span><br><span class="line">  <span class="keyword">let</span> dispatch = compose(...middles)(store.dispatch);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...store,</span><br><span class="line">    dispatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>最终版 redux 库</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> createStore = <span class="function">(<span class="params">reducer, fn</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> state;</span><br><span class="line">    <span class="keyword">let</span> listeners = [];</span><br><span class="line">    <span class="keyword">let</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> state;</span><br><span class="line">    <span class="keyword">let</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">        state = reducer(state, action);</span><br><span class="line">        listeners.forEach(<span class="function"><span class="params">item</span> =&gt;</span> item());</span><br><span class="line">    &#125;;</span><br><span class="line">    dispatch(&#123;&#125;);</span><br><span class="line">    <span class="keyword">let</span> subscribe = <span class="function">(<span class="params">l</span>) =&gt;</span> &#123;</span><br><span class="line">        listeners.push(l);</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            listeners = listeners.filter(<span class="function"><span class="params">item</span> =&gt;</span> item !== l);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn === <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn(createStore, reducer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        createStore,</span><br><span class="line">        dispatch,</span><br><span class="line">        getState,</span><br><span class="line">        subscribe</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> combineReducers = <span class="function">(<span class="params">reducers</span>) =&gt;</span> <span class="function">(<span class="params">newState = &#123;&#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> reducers) &#123;</span><br><span class="line">        newState[key] = reducers[key](newState[key], action)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newState;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> bindActionCreators = <span class="function">(<span class="params">actions, dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> actions) &#123;</span><br><span class="line">        obj[key] = <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(actions[key](...args))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> applyMiddleware = <span class="function">(<span class="params">...middlewares</span>) =&gt;</span> <span class="function">(<span class="params">createStore, reducer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line">    <span class="keyword">let</span> middles = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(store));</span><br><span class="line">    <span class="keyword">let</span> dispatch = compose(...middles)(store.dispatch);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...store,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> compose = <span class="function">(<span class="params">...fns</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> fn = fns.pop();</span><br><span class="line">        <span class="keyword">return</span> fns.reduceRight(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> next(prev);</span><br><span class="line">        &#125;, fn(...args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;createStore, combineReducers, bindActionCreators, applyMiddleware, compose&#125;</span><br></pre></td></tr></table></figure>

<h4 id="React-Redux-流程"><a href="#React-Redux-流程" class="headerlink" title="React-Redux 流程"></a>React-Redux 流程</h4><blockquote>
<p><strong>React-Redux 是把 redux 进一步封装，适配 react 项目，让 redux 操作更简洁</strong></p>
<ul>
<li>store 文件夹中的内容和 redux 一样</li>
<li>在组件调取使用的时候可以优化一些步骤</li>
</ul>
<blockquote>
<p><strong>React-Redux 常用组件</strong></p>
<ol>
<li><p>Provider 根组件（放在最外层，双闭合标签）</p>
<p>当前整个项目都在 Provider 组件下，作用就是把创建的 store 可以供内部任何后代组件使用（基于上下文 context 完成的）</p>
<ul>
<li><p>Provider 组件中只允许出现一个子元素</p>
</li>
<li><p>把创建的 store 基于属性传递给 Provider（这样后代组件中都可以使用这个 store 了）【作用：不用再通过属性把 store 传给每一个组件，只要传给 Provider，后代中的每一个组件都可以使用 store 了】</p>
</li>
</ul>
</li>
<li><p>connect 高阶组件</p>
</li>
</ol>
</blockquote>
<p><strong>相对于传统的 redux，做的步骤优化</strong></p>
<ol>
<li><p>导出的不再是创建的组件，而是基于 connect 构造后的高阶组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">connect(mapStateToProps, mapDispatchToProps)(Component)</span><br><span class="line">	- mapStateToProps: 把 redux 容器中的状态信息遍历，赋值给当前组件的属性(state)</span><br><span class="line">	- mapDispatchToProps: 把 redux 中的 dispatch 派发行为遍历，赋值给组件的属性(actionCreator)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=&gt; 把 redux 容器中的状态信息遍历，赋值给当前组件的属性(state)</span></span><br><span class="line"><span class="keyword">let</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; state: 就是 redux 容器中的状态信息</span></span><br><span class="line">  <span class="comment">//=&gt; 返回的是什么，就把它挂载到当前组件的属性上（redux 存储很多信息，想用什么就返回什么即可）</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state.xxx <span class="comment">// 将 xxx 这个板块存储的所有信息全部拿到并返回</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//=&gt; 把 redux 中的 dispatch 派发行为遍历，赋值给组件的属性(actionCreator)</span></span><br><span class="line"><span class="keyword">let</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; dispatch: store 中存储的 dispatch 方法</span></span><br><span class="line">  <span class="comment">//=&gt; 返回的是什么，就把它挂载到当前组件的属性上（一般挂载一些方法，这些方法中完成了 dispatch 派发任务操作）</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init(initData) &#123;</span><br><span class="line">      dispatch(action.vote.init(initData));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Component)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化写法(和上面相等): react-redux 帮我们做了一件事情，把 actionCreator 中编写的方法（返回 action 对象的方法），自动构建成 dispatch 派发任务的方法，也就是 mapDispatchToProps 这种格式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;...state.vote&#125;) , action.vote)(Component)</span><br></pre></td></tr></table></figure>
</li>
<li><p>react-redux 帮助我们做了一件非常重要的事情：以前我们需要自己基于 subscribe 向事件池追加方法，以达到容器状态信息改变、执行我们追加的方法、重新渲染组件的目的；但现在不用了（不用再写 subscribe 方法），react-redux 帮我们做了这件事：<strong>“所有用到 redux 容器状态信息的组件，都会向事件池中追加一个方法，当状态信息改变，通知方法执行，把最新的状态信息作为属性传递给组件，组件的属性改变了，组件也会重新渲染”</strong></p>
</li>
</ol>
</blockquote>
<ul>
<li><p>安装 react-redux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn add react-redux</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在当前项目的根目录下使用 Provider 组件，并且把创建好的 redux 容器（store）当作属性传给 Provider【目的是让以后所有的子组件都可以使用 store】</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line">	&lt;section&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在组件中不直接导出自己的组件，而是导出使用 connect 执行后的高阶函数组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123; <span class="keyword">return</span> &#123;&#125; &#125;;</span><br><span class="line"><span class="keyword">let</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123; <span class="keyword">return</span> &#123;&#125; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(myComponent)</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// 简化写法(和上面相等): react-redux 帮我们做了一件事情，把 actionCreator 中编写的方法（返回 action 对象的方法），自动构建成 dispatch 派发任务的方法，也就是 mapDispatchToProps 这种格式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;...state.xxx&#125;), action.vote)(myComponent)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component/派发任务</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">"../store/action"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VoteHandle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;support, against&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">'panel-footer'</span>&gt;</span></span></span><br><span class="line">      &lt;button className="btn btn-success"</span><br><span class="line">              onClick=&#123;support&#125;&gt;</span><br><span class="line">        支持</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span></span><br><span class="line">      &lt;button className="btn btn-danger"</span><br><span class="line">              onClick=&#123;against&#125;&gt;</span><br><span class="line">        反对</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;...state.vote&#125;), action.vote)(VoteHandle)</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// component/获取状态</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">'../store/action'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VoteBase</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">  &#125;;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.init(&#123;</span><br><span class="line">      title: <span class="string">'吃了么'</span>,</span><br><span class="line">      n: <span class="number">0</span>,</span><br><span class="line">      m: <span class="number">100</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">'panel panel-default'</span>&gt;</span></span></span><br><span class="line">    &lt;div className='panel-heading'&gt;</span><br><span class="line">      &lt;h3 className='panel-title'&gt;</span><br><span class="line">        &#123;title&#125;</span><br><span class="line">      &lt;/h3&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &lt;div className="panel-body"&gt;</span><br><span class="line">      支持人数：&lt;span&gt;&#123;n&#125;&lt;/span&gt;</span><br><span class="line">      &lt;br/&gt;</span><br><span class="line">      反对人数：&lt;span&gt;&#123;m&#125;&lt;/span&gt;</span><br><span class="line">      &lt;br/&gt;</span><br><span class="line">      支持比例：&lt;span&gt;&#123;(n / (n + m) * 100).toFixed(2) + '%'&#125;&lt;/span&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=&gt; 把 redux 容器中的状态信息遍历，赋值给当前组件的属性(state)</span></span><br><span class="line"><span class="keyword">let</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; state: 就是 redux 容器中的状态信息</span></span><br><span class="line">  <span class="comment">//=&gt; 返回的是什么，就把它挂载到当前组件的属性上（redux 存储很多信息，想用什么就返回什么即可）</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state.vote <span class="comment">// 获取 vote 板块的全部信息</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//=&gt; 把 redux 中的 dispatch 派发行为遍历，赋值给组件的属性(actionCreator)</span></span><br><span class="line"><span class="keyword">let</span> mapDispatchToProps = <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; dispatch: store 中存储的 dispatch 方法</span></span><br><span class="line">  <span class="comment">//=&gt; 返回的是什么，就把它挂载到当前组件的属性上（一般挂载一些方法，这些方法中完成了 dispatch 派发任务操作）</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init(initData) &#123;</span><br><span class="line">      dispatch(action.vote.init(initData));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(VoteBase);</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;Provider, connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line">	&lt;section className='panel panel-default' style=&#123;&#123;width: '50%', margin: '20px auto'&#125;&#125;&gt;</span><br><span class="line">  	&lt;VoteVase/&gt;</span><br><span class="line">    &lt;VoteHandle/&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<h3 id="React-amp-React-Redux-流程-机制"><a href="#React-amp-React-Redux-流程-机制" class="headerlink" title="React &amp; React-Redux 流程/机制"></a>React &amp; React-Redux 流程/机制</h3><p><strong>应用场景</strong></p>
<p>当多个组件想共用一套信息管理的时候，使用 redux 做统一的存储和管理（A 组件存，B 组件就可以获取到）</p>
<p><strong>真实项目中</strong></p>
<p>从服务器把数据得到之后，可以把它临时存到 redux 中，这样只要页面不刷新，所有的重新渲染等直接从 redux 中拿数据渲染即可，不需要向服务器发送请求，减少 http 请求次数，减轻服务器压力</p>
<h4 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h4><blockquote>
<p>redux 给我们提供了两个常用的方法</p>
</blockquote>
<ol>
<li>createStore（创建容器） <ul>
<li>store 中的常用方法<ol>
<li><code>store.getState()</code> 获取容器中的状态信息</li>
<li><code>store.dispatch(action)</code> 派发任务，派发一个 action 对象，action 对象中有一个 type 就是行为标示，其他值为 payload；dispatch 派发之后，会把 action 对象传给 reducer，reducer 通过不同的行为标示去把 redux 容器中的状态改变【<strong>dispatch 派发一个 action，通知 reducer，reducer 根据 action 标示执行对应函数，把容器中的状态更改</strong>】</li>
<li><code>store.subsrcibe()</code> 向事件池中追加方法，当 dispatch 派发，reducer 把容器中的状态修改之后，把事件池中的方法拿出来依次执行即可</li>
</ol>
</li>
</ul>
</li>
<li>combineReducers（合并 reducer - 因为一个 store 中只能有一个 reducer）</li>
</ol>
<h4 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h4><blockquote>
<p>react-redux 优化了 redux 流程</p>
</blockquote>
<ol>
<li>根元素是 Provider 组件，把 store 通过属性传给它，它可以通过上下文传递给每一个子元素</li>
<li>在每个组件直接通过 connect 高阶组件包一下，先把 redux 容器中的 *<em>状态、 action *</em>赋值给当前组件的属性，所以当前组件属性中有所有的状态信息、派发行为操作信息，直接操作即可；并且 react-redux 把所有用到当前 redux 容器中状态信息的组件都做可以个事件监听，一旦容器中的状态信息改变，就会通知事件池中的方法执行，把组件重新渲染</li>
</ol>
<h3 id="Redux-amp-React-Redux-原理"><a href="#Redux-amp-React-Redux-原理" class="headerlink" title="Redux &amp; React-Redux 原理"></a>Redux &amp; React-Redux 原理</h3><h4 id="Redux-原理之-createStore"><a href="#Redux-原理之-createStore" class="headerlink" title="Redux 原理之 createStore"></a>Redux 原理之 createStore</h4><blockquote>
<p>将状态放到了 createStore 函数中，目的是隔离作用域，并且再内部返回深度克隆的对象，这样用户无法再通过外界更改状态。但是状态应该由我们自身来控制，应该是外界传入的，所以要将状态拿出 createStore。并且判断的逻辑也应该由我们自己来编写</p>
</blockquote>
<p>createStore：创建 redux 容器</p>
<ul>
<li>参数(@parms)<ul>
<li>reducer：函数</li>
</ul>
</li>
<li>返回值(@return)<ul>
<li>store: {<pre><code>            getState,
dispatch,
subscribe</code></pre>  }</li>
</ul>
</li>
</ul>
<blockquote>
<p>createStore 源码不足之处：取消订阅时，直接删除那一项，没有做处理，可能会导致数组塌陷</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; 创建一个 store，state 用来存储管理的状态信息，listenAry 用来存储事件池中的方法</span></span><br><span class="line">  <span class="comment">//=&gt; state 不用设置初始值，因为第一个 dispatch 执行 reducer，state 没有值，走的是 reducer 中赋值的默认信息，我们自己会在创建容器的时候就把 dispatch 执行一次</span></span><br><span class="line">  <span class="keyword">let</span> state,</span><br><span class="line">      listenAry = [];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//=&gt; dispatch：基于 dispatch 实现任务派发</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 执行 reducer，修改容器中的状态信息（接收 reducer 的返回值，把返回的信息替换原有的 state），值得注意的是：我们是把返回值全部替换 state，所有要求 reducer 中再修改状态之前，要先把原始的状态信息克隆一份，再进行单个的属性修改</span></span><br><span class="line">    state = reducer(state, action)</span><br><span class="line">    <span class="comment">// 2. 容器中状态信息经过 reducer 修改后，通知事件池中的方法执行</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listenAry.length; i++)&#123;</span><br><span class="line">      <span class="keyword">let</span> item = listenAry[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> item === <span class="string">'function'</span>) &#123;</span><br><span class="line">        item();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        listenAry.splice(i, <span class="number">1</span>);</span><br><span class="line">        i--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(&#123;<span class="attr">type</span>: <span class="string">'$$INIT_DEFAULT_STATE'</span>&#125;); <span class="comment">//=&gt; 创建容器的时候执行一次 dispatch，目的是把 reducer 中的默认状态信息赋值给 redux 容器中的状态</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//=&gt; getState：获取容器中的状态信息</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//=&gt; 1. 需要保证返回的状态信息不能和容器中的 state 是一个堆内存（否则外面获取状态信息后，直接就可以修改容器中的状态了，这不符合 dispatch -&gt; reducer 才能改状态的规范）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state)); <span class="comment">//=&gt; 深克隆对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//=&gt; subscribe：向事件池中追加方法</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//=&gt; 1. 向容器中追加方法（重复验证）</span></span><br><span class="line">    <span class="keyword">let</span> isExit = listenAry.includes(fn);</span><br><span class="line">    !isExit ? listenAry.push(fn) : <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//=&gt; 2. 返回一个方法：执行返回的方法会把当前绑定的方法在事件池中移除掉</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> index = listenAry.indexOf(fn);</span><br><span class="line">      <span class="comment">// listenAry.splice(index, 1);//=&gt; 可能会引发数组塌陷</span></span><br><span class="line">      listenAry[index] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    getState,</span><br><span class="line">    subscribe</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">//=&gt; 用法</span></span><br><span class="line"><span class="keyword">let</span> reducer = <span class="function">(<span class="params">state = &#123;&#125;, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//=&gt; state：原有状态信息</span></span><br><span class="line">  <span class="comment">//=&gt; action：派发任务时候传递的行为对象</span></span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">      <span class="comment">// ... 根据 type 执行不同的 state 修改操作</span></span><br><span class="line">    <span class="keyword">case</span> Types.xxx: </span><br><span class="line">      state = &#123;...state, <span class="attr">n</span>: <span class="number">100</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state; <span class="comment">// 返回的 state 会替换原有的 state</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer); <span class="comment">//=&gt; createStore 的时候把 reducer 传递进来，但是此时 reducer 并没有执行，只有 dispatch 的时候才执行，通过执行 reducer 修改容器中的状态</span></span><br><span class="line">store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'xxx'</span>, ...&#125;)</span><br><span class="line"><span class="keyword">let</span> unsubscribe = store.subscribe(fn)</span><br><span class="line">unsubscribe()</span><br></pre></td></tr></table></figure>

<h4 id="Redux-原理之-combineReducers"><a href="#Redux-原理之-combineReducers" class="headerlink" title="Redux 原理之 combineReducers"></a>Redux 原理之 combineReducers</h4><p>combineReducers：reducer 合并的方法</p>
<ul>
<li>参数(@parms)<ul>
<li>对象，对象中包含了每一个板块对象的 reducer =&gt; {xxx: function reducer…}</li>
</ul>
</li>
<li>返回值(@return)<ul>
<li>返回的是一个新的 reducer 函数（把这个值赋值给 createStore）</li>
</ul>
</li>
</ul>
<blockquote>
<p>特殊处理：合并 reducer 之后，redux 容器中的 state 也变为对应对象管理的模式 =&gt; {xxx: {} …}</p>
<p><strong>所谓的 reducer 合并，其实并不是把所有小方法合并到一起了，而是有一个总的方法用来管控，以后每一次 dispatch 派发的时候，都先找到总的方法，而在总的方法中把每一个小的方法都执行一遍（把每个版块小的 reducer 管控/最新的状态都拿到，拿到之后综合成一个最大的）</strong></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; reducers：传递进来的 reducer 对象集合</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * &#123;</span></span><br><span class="line"><span class="comment">   *		vote: function vote(state=&#123;n: 0, m: 0&#125;, action)&#123;... return state; &#125;,</span></span><br><span class="line"><span class="comment">   * 		personal: function personal(state=&#123;baseInfo: ''&#125;, action)&#123;... return state; &#125;</span></span><br><span class="line"><span class="comment">   * &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//=&gt; dispatch 派发执行的时候，执行的是返回的 reducer，这里也要返回一个最终的 state 对象替换原有的 state，而且这个 state 中包含每个模块的状态信息 =&gt; &#123;vote: ..., personal: ...&#125;</span></span><br><span class="line">    <span class="comment">//=&gt; 所谓的 reducer 合并，其实就是 dispatch 派发的时候，把每一个模块的 reducer 都单独执行一遍，把每个模块返回的状态最后汇总在一起，替换容器中的状态信息</span></span><br><span class="line">   	<span class="keyword">let</span> newState = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> reducers) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!reducers.hasOwnProperty(key)) <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">//=&gt; reducers[key]：每个模块单独的 reducer</span></span><br><span class="line">      <span class="comment">//=&gt; state[key]：当前模块在 redux 容器中存储的状态信息</span></span><br><span class="line">      <span class="comment">//=&gt; 返回值是当前模块最新的状态，把它再放到 newState 中</span></span><br><span class="line">      newState[key] = reducers[key](state[key], action);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newState;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">============================================================</span><br><span class="line"><span class="comment">//=&gt; 用法</span></span><br><span class="line">store = createStore(reducer);</span><br><span class="line">store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'xxx'</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="React-Redux-原理之-Provider"><a href="#React-Redux-原理之-Provider" class="headerlink" title="React-Redux 原理之 Provider"></a>React-Redux 原理之 Provider</h4><p>Provider：当前项目的“根”组件</p>
<ol>
<li>接收通过属性传递进来的 store，把 store 挂在到上下文中，这样当前项目中任何一个组件中，想要使用 redux 中的 store，直接通过上下文获取即可</li>
<li>在组件的 render 中，把传递给 Provider 的子元素渲染</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; 设置上下文信息类型</span></span><br><span class="line">  <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">    store: PropTypes.object</span><br><span class="line">  &#125;;</span><br><span class="line">	<span class="comment">//=&gt; 设置上下文信息值</span></span><br><span class="line">	getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      store: <span class="keyword">this</span>.props.store</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> Provider;</span><br></pre></td></tr></table></figure>

<h4 id="React-Redux-原理之-connect"><a href="#React-Redux-原理之-connect" class="headerlink" title="React-Redux 原理之 connect"></a>React-Redux 原理之 connect</h4><p>connect：高阶组件 -&gt; 利用柯里化函数思想（大函数执行返回一个小函数）创建出来的一个组件就是高阶组件</p>
<ul>
<li><p>参数(@parms)</p>
<ul>
<li><p>mapStateToProps：回调函数，把 redux 中的部分状态信息（方法返回的内容）挂载到指定组件的属性上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//=&gt; state: redux 容器中的状态信息</span></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;; <span class="comment">//=&gt; return 对象中有什么，就把什么挂载到属性上</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>mapDispatchToProps：回调函数，把一些需要派发的任务方法也挂载到组件的属性上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//=&gt; dispatch: redux 容器中的 dispatch</span></span><br><span class="line">  <span class="comment">//=&gt; return 对象中有什么，就把什么挂载到属性上（返回的方法中有执行 dispatch 派发任务</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">      dispatch(&#123;...&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>返回值(@return)</p>
<ul>
<li>返回一个新的函数</li>
</ul>
</li>
</ul>
<p>============================================================</p>
<p>返回的新函数 connectHOT</p>
<ul>
<li>参数(@parms)<ul>
<li>传递进来的是要操作的组件，需要把指定的属性和方法都挂载到当前组件的属性上</li>
</ul>
</li>
<li>返回值(@return)<ul>
<li>返回一个新的组件 Proxy（代理组件），在代理组件中，我们要获取 Provider 在上下文中存储的 store，紧接着获取 store 和 dispatch，把 mapStateToProps、mapDispatchToProps 回调函数执行，接受返回的结果，再把这些结果挂载到 Component 这个要操作组件的属性上</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">connectHOT</span>(<span class="params">Component</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">      <span class="comment">//=&gt; 获取上下文中的 store</span></span><br><span class="line">      <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">      	store: PropTypes.object</span><br><span class="line">    	&#125;;</span><br><span class="line">    	<span class="comment">//=&gt; 获取 store 中的 state/dispatch，把传递的两个回调函数执行，接受返回的结果</span></span><br><span class="line">    	<span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">      	<span class="keyword">super</span>(props, context);</span><br><span class="line">      	<span class="keyword">this</span>.state = <span class="keyword">this</span>.queryMountProps();</span><br><span class="line">    	&#125;;</span><br><span class="line">    	<span class="comment">//=&gt; 渲染 Component 组件，并且把获取的信息（状态、方法）挂载到组件属性上（单独调取 Proxy 组件的时候传递的属性也给 Component）</span></span><br><span class="line">    	render() &#123;</span><br><span class="line">      	<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...this.state</span>&#125; &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">    	&#125;;</span><br><span class="line">    	<span class="comment">//=&gt; 基于 redux 中的 subscribe 向事件池中追加一个方法，当容器中状态改变，需要重新获取最新的状态信息，并且重新把 componrnt 渲染，把最新的状态信息通过属性传递给 component</span></span><br><span class="line">    	componentDidMount() &#123;</span><br><span class="line">      	<span class="keyword">this</span>.context.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        	<span class="keyword">this</span>.setState(<span class="keyword">this</span>.queryMountProps());</span><br><span class="line">      	&#125;);</span><br><span class="line">    	&#125;;</span><br><span class="line">    	<span class="comment">//=&gt; 从 redux 中获取最新的信息，基于回调函数筛选，返回的是需要挂载到组件属性上的信息</span></span><br><span class="line">    	queryMountProps = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;store&#125; = <span class="keyword">this</span>.context,</span><br><span class="line">            state = store.getState();</span><br><span class="line">        <span class="keyword">let</span> propsState = <span class="keyword">typeof</span> mapStateToProps === <span class="string">'function'</span> ? mapStateToProps(state) : &#123;&#125;;</span><br><span class="line">        <span class="keyword">let</span> propsDispatch = <span class="keyword">typeof</span> mapDispatchToProps === <span class="string">'function'</span> ? mapDispatchToProps(store.dispatch) : &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...propsState,</span><br><span class="line">          ...propsDispatch</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> connect;</span><br></pre></td></tr></table></figure>

<h2 id="5-React-组件的生命周期函数"><a href="#5-React-组件的生命周期函数" class="headerlink" title="5. React 组件的生命周期函数"></a>5. React 组件的生命周期函数</h2><blockquote>
<p><strong>生命周期函数（钩子函数）</strong></p>
<p>描述一个组件或者程序从创建到销毁的过程，我们可以在过程中间基于钩子函数完成一些自己的操作（例如：在第一次渲染完成做什么，或者在二次即将重新渲染之前做什么等…）</p>
</blockquote>
<ul>
<li><p><strong>基础流程</strong></p>
<ul>
<li>constructor 创建一个组件</li>
<li>componentWillMount 第一次渲染之前</li>
<li>render 第一次渲染</li>
<li>componentDidMount 第一次渲染之后</li>
</ul>
</li>
<li><p><strong>状态（state）更新触发</strong></p>
<p>当组件的状态数据发生改变（setState）或者传递给组件的属性发生改变（重新调用组件传递不同的属性）都会引发 render 重新执行渲染（渲染也是差异渲染）</p>
<ul>
<li>shouldComponentUpdate 是否允许组件重新渲染（允许则执行后面函数，不允许直接结束即可）</li>
<li>componentWillUpdate 重新渲染之前</li>
<li>render 第二次及以后重新渲染</li>
<li>componentDidUpdate 重新渲染之后</li>
</ul>
</li>
<li><p><strong>属性（props）更新触发</strong></p>
<ul>
<li>componentWillReceiveProps 父组件把传递给子组件的属性发生改变后触发的钩子函数</li>
<li>shouldComponentUpdate 是否允许组件重新渲染（允许则执行后面函数，不允许直接结束即可）</li>
<li>componentWillUpdate 重新渲染之前</li>
<li>render 第二次及以后重新渲染</li>
<li>componentDidUpdate 重新渲染之后</li>
</ul>
</li>
<li><p><strong>卸载（原有渲染的内容是不消失的，只不过以后不能基于数据改变视图了）</strong></p>
<ul>
<li>componentWillUnmount 卸载组件之前</li>
</ul>
</li>
</ul>
<blockquote>
<p>React 组件是第一次挂载还是修改以有没有执行过 render 为判断标准，执行过 render 就是修改，没有执行过 render 就是第一次挂载</p>
</blockquote>
<blockquote>
<p>到底是在 componentWillMount 还是 componentDidMount 中做数据请求，主要取决于获取数据是同步还是异步；如果获取数据是同步，放在 componentWillMount 中，那么第一次就显示的真实数据；如果获取数据是异步，那么不管是在 componentWillMount / componentDidMount / async、await 处理数据，怎么着第一次都是初始数据，第二次才是真实数据</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="number">2</span>)</span><br><span class="line">      &#125;, <span class="number">3000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//=&gt; 这是第一个执行的，执行完成后（给属性设置默认值）才向下执行</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1=constructor'</span>);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">n</span>: <span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentWillMount() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 在componentWillMount中，如果直接setState修改数据，会把状态信息改变后，然后render和componentDidMount；但如果setState是放到一个异步操作中完成（例如：定时器/从服务器获取数据），也是先执行render和componentDidMount，然后再执行这个异步操作修改状态，紧接着走修改的流程（这样和放到componentDidMount中没什么区别，所以一般把数据请求放到componentDidMount中处理</span></span><br><span class="line">    <span class="comment">//=&gt; 真实项目中的数据绑定，一般第一次组件渲染，我们都是绑定的默认数据，第二次才是绑定的从服务器获取的数据（有些需求我们需要根据数据是否存在判断显示隐藏等）</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2=componentWillMount: 第一次渲染之前'</span>, <span class="keyword">this</span>.refs.HH); <span class="comment">// undefined</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    this.setState(&#123;</span></span><br><span class="line"><span class="comment">      n: 2</span></span><br><span class="line"><span class="comment">    &#125;) </span></span><br><span class="line"><span class="comment">    console.log(this.state.n); // 1</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//=&gt; 或者使用async/await等在componentWillMount中处理异步操作</span></span><br><span class="line">	<span class="keyword">async</span> componentWillMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2=componentWillMount: 第一次渲染之前'</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> queryData();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      n: result</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'3/7=render'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">'HH'</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;this.state.n&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentDidMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'4=componentDidMount: 第一次渲染之后'</span>, <span class="keyword">this</span>.refs.HH); <span class="comment">// &lt;div&gt;1&lt;/div&gt;</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 真实项目中在这个阶段一般作如下处理：</span></span><br><span class="line"><span class="comment">     * 		1. 控制状态信息更改的操作</span></span><br><span class="line"><span class="comment">     * 		2. 从服务器获取数据，然后修改状态信息，完成数据绑定</span></span><br><span class="line"><span class="comment">     * 		...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">n</span>: <span class="keyword">this</span>.state.n + <span class="number">1</span>&#125;)</span><br><span class="line">    &#125;, <span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">	shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *  在这个钩子函数中，我们获取的state不是最新修改的，而是上一次的state值（this.stata.xx/this.props.xx）</span></span><br><span class="line"><span class="comment">     * 		例如：第一次加载完成，5000ms后，我们基于setState把n修改为2，但此处获取的还是1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  但这个方法有两个参数</span></span><br><span class="line"><span class="comment">     * 		nextProps：最新修改的属性信息</span></span><br><span class="line"><span class="comment">     *		nextState：最新修改的状态信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'5=shouldComponentUpdate: 是否允许更新，函数返回true就是允许，返回false就是不允许'</span>);</span><br><span class="line">    <span class="keyword">if</span> (nextState.n &gt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentWillUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="comment">//=&gt; 这里获取的状态是更新之前的（和shouldComponentUpdate相同也有两个参数存储最新的信息）</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'6=componentWillUpdate: 组件更新之前'</span>, <span class="keyword">this</span>.state.n, nextState); <span class="comment">// 1, 2</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentDidUpdate() &#123;</span><br><span class="line">    <span class="comment">//=&gt; 这里获取的状态是更新之后的</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'8=componentDidUpdate: 组件更新之后'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">A</span> /&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1=constructor'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentWillMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2=componentWillMount: 第一次渲染之前'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">	render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'3=render'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">'HH'</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;this.props.n&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	componentDidMount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'4=componentDidMount: 第一次渲染之后'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentWillReceiveProps(nextProps, nextState) &#123;</span><br><span class="line">    <span class="comment">//=&gt; 属性改变也会触发子组件重新渲染，继续完成修改这套流程</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'组件属性改变'</span>, <span class="keyword">this</span>.props.n, nextProps.n);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  shouldComponentUpdate(nextProps, nextState) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'shouldComponentUpdate'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">n</span>: <span class="number">1</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    setTImeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        n: <span class="number">2</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">	render() &#123;</span><br><span class="line">		<span class="comment">//=&gt; 复合组件：组件嵌套（大组件嵌套小组件）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/*把父组件的状态信息作为属性传递给子组件*/&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">A</span> <span class="attr">n</span>=<span class="string">&#123;this.state.n&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">B</span> /&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<h2 id="6-React-路由"><a href="#6-React-路由" class="headerlink" title="6. React 路由"></a>6. React 路由</h2><h3 id="单页面应用-amp-多页面应用"><a href="#单页面应用-amp-多页面应用" class="headerlink" title="单页面应用 &amp; 多页面应用"></a>单页面应用 &amp; 多页面应用</h3><ul>
<li>单页面应用（SPA：signle-page-web-applecation）【一个产品只有一个页面，所有内容的展示和业务的处理都是在这个页面完成的】<ul>
<li>只有一个页面，所有需要展示的内容都在这一个页面中实现切换，webpack 中只需要配置一个入口即可（移动端单页面应用居多 或者 PC端管理系统类也是单页面应用为主）</li>
</ul>
</li>
<li>多页面应用（MPA：multi-page-web-applecation）【一个产品包含很多页面，通过页面之前的跳转完成业务逻辑的衔接等】<ul>
<li>一个项目由很多页面组成，使用这个产品，主要就是页面之间的跳转（PC 端多页面应用居多）；基于框架开发的时候，需要在 webpack 中配置多入口，每个入口对应一个页面</li>
</ul>
</li>
</ul>
<blockquote>
<p>如何实现单页面应用？</p>
<ol>
<li>如果项目时基于服务器渲染的，后台语言当中可以基于<code>include</code>等技术，把很多部分拼凑在一起，实现组件化或者插件化开发，也可以实现单页面应用</li>
<li>基于 iframe 实现单页面应用</li>
<li>模块化开发<ul>
<li>AMD：require.js</li>
<li>CMD：sea.js</li>
<li>基于这些思想把每一部分单独写成一个模块，最后基于 grunt / gulp / fis 等自动化工具，最后把所有的模块都合并到首页面中（包括 html、css、js 都合并到一起），通过控制哪些模块的显示隐藏来实现单页面应用开发</li>
<li>弊端：由于首页中的内容包含了所有模块的信息，所以第一次加载速度很慢（虽然可以解决，但是相对来说比较麻烦）</li>
</ul>
</li>
<li>基于 Vue / React 实现模块化/组件化开发，基于它们提供的路由实现 SPA 单页面应用，基于 webpack 打包等</li>
</ol>
</blockquote>
<h3 id="使用-react-路由-react-router-dom-实现单页面应用"><a href="#使用-react-路由-react-router-dom-实现单页面应用" class="headerlink" title="使用 react 路由 (react-router-dom) 实现单页面应用"></a>使用 react 路由 (react-router-dom) 实现单页面应用</h3><blockquote>
<p>学习 react 路由： <a href="https://reacttraining.com/react-router/web/guides/quick-start" target="_blank" rel="noopener">https://reacttraining.com/react-router/web/guides/quick-start</a></p>
</blockquote>
<ul>
<li><p>安装路由（3及以前版本称为 react-router，4及最新版本称为 react-router-dom）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn add react-router-dom</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入 react-router-dom</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HashRouter, ... &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p><strong>注意：React-Router 中提供的组件都要在任何一个 Router（HashRouter）包裹的范围内使用</strong></p>
</blockquote>
<h3 id="BrowserRouter-VS-HashRouter-VS-MemoryRouter"><a href="#BrowserRouter-VS-HashRouter-VS-MemoryRouter" class="headerlink" title="BrowserRouter VS HashRouter VS MemoryRouter"></a>BrowserRouter VS HashRouter VS MemoryRouter</h3><p>它是两种常用的路由实现思想，BrowserRouter 浏览器路由，HashRouter 哈希路由</p>
<ul>
<li><p>BrowserRouter </p>
<ul>
<li><p>它是基于 H5 中的 history API (pushState, replaceState, popstate) 来保持 UI 和 URL 的同步，<strong>真实项目中应用的不多，一般只有当前项目是基于服务器渲染的，我们才会使用浏览器路由</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://www.demo.com/</span></span><br><span class="line"><span class="attribute">http://www.demo.com/personal/</span></span><br><span class="line"><span class="attribute">http://www.demo.com/personal/login</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>HashRouter</p>
<ul>
<li><p>真实项目中（前后端分离的项目：客户端渲染），经常使用的是哈希路由来完成的，它依据相同的页面地址，不同的哈希值，来规划当前页面中的哪一个组件呈现渲染，它基于原生 JS 构造了一套类似于 history API 的机制，每一次路由切换都是基于 history stack 完成的</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http://www.demo.com/#/</span></span><br><span class="line"><span class="attribute">http://www.demo.com/#/personal/</span></span><br><span class="line"><span class="attribute">http://www.demo.com/#/personal/login</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>MemoryRouter</p>
<ul>
<li>在内存中管理history，地址栏不会变化。在reactNative中使用。</li>
</ul>
</li>
</ul>
<blockquote>
<p>在开发时我们一般使用 HashRouter,上线后我们改用 BrowserRouter</p>
</blockquote>
<h3 id="HashRouter-amp-Route"><a href="#HashRouter-amp-Route" class="headerlink" title="HashRouter &amp; Route"></a>HashRouter &amp; Route</h3><p><strong>HashRouter</strong></p>
<ol>
<li>当前项目一旦使用 HashRouter，则默认在页面的地址后面加上“#/”，也就是 hash 默认值是一个斜杠，一般让其显示首页组件信息状态</li>
<li>HashRouter 中只能出现一个子元素</li>
<li>HashRouter 机制中，需要根据哈希地址不同，展示不同的组件内容，此时需要使用 Route</li>
</ol>
<p><strong>Route</strong></p>
<ul>
<li><p>path：设置匹配地址，但是默认不是严格匹配，当前页面哈希地址只要包含完整的它（内容是不变的），都能匹配上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path&#x3D;&#39;&#x2F;&#39;: 和它匹配的地址只要有斜杠即可（都能和它匹配）</span><br><span class="line">path&#x3D;&#39;&#x2F;user&#39;: “#&#x2F;user&#x2F;login” 也可以匹配，但是 “#&#x2F;user2“ 无法匹配</span><br></pre></td></tr></table></figure>
</li>
<li><p>component：一旦哈希值和当前 route 的 path 相同了，则渲染 component 指定的组件</p>
</li>
<li><p>exact：让 path 的匹配严谨和严格一些（只有 url 哈希值和 path 设定的值相等才可以匹配到）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path: &#39;&#x2F;&#39;: “#&#x2F;” 匹配，但是“#&#x2F;user”就不再匹配了</span><br></pre></td></tr></table></figure>
</li>
<li><p>render：当页面的哈希地址和 path 匹配，会把 render 规划的方法执行，在方法中一般做“权限校验”（渲染组件之前验证是否存在权限，不存在做一些特殊处理）</p>
</li>
<li><p>strict：严格严谨模式（一般不用，只有限定 path 后面必须再有一个子目录时才会使用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path: &#39;&#x2F;user&#x2F;&#39;: “&#x2F;user” 不匹配，“&#x2F;user&#x2F;” 匹配，“&#x2F;user&#x2F;login” 匹配</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>路由匹配：有的时候我们希望对路由匹配有些限制,比如说严格对某个路径进行匹配,或者匹配到某个路径时就不在匹配</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter, Route&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> A <span class="keyword">from</span> <span class="string">'./component/A'</span>;</span><br><span class="line"><span class="keyword">import</span> B <span class="keyword">from</span> <span class="string">'./component/B'</span>;</span><br><span class="line"><span class="keyword">import</span> C <span class="keyword">from</span> <span class="string">'./component/C'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;Route path='/' exact component=&#123;A&#125;/&gt;</span><br><span class="line">		&lt;Route path='/user/' component=&#123;B&#125;/&gt;</span><br><span class="line">  	&lt;Route path='/pay' render=&#123;() =&gt; &#123;</span><br><span class="line">      //=&gt; 一般在 render 中处理的是权限校验</span><br><span class="line">      let flag = localStorage.getItem('FLAG');</span><br><span class="line">      if (flag &amp;&amp; flag === 'STATE') &#123;</span><br><span class="line">        return &lt;C/&gt;;</span><br><span class="line">      &#125;</span><br><span class="line">      return '当前环境不安全，不利于支付'</span><br><span class="line">    &#125;&#125;/&gt;</span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<h3 id="Switch-amp-Redirect"><a href="#Switch-amp-Redirect" class="headerlink" title="Switch &amp; Redirect"></a>Switch &amp; Redirect</h3><p><strong>Switch</strong></p>
<p>默认情况下，会和每一个 route 都做校验（哪怕之前已经有校验成功的），Switch 组件可以解决这个问题，和 switch case 一样，只要有一个情况校验成功，就不再向后校验了</p>
<p><strong>Redirect</strong></p>
<p>重定向</p>
<ul>
<li>to [string]: 重新定向到新的地址</li>
<li>to [object]: 重新定向到新的地址，只不过制定了更多的信息<br>{<pre><code>pathname: 定向的地址
search: 给定向的地址问号传参（真实项目中，有时会根据是否存在问号传参数值来统计是正常进入首页还是非正常跳转过来的，也有可能根据问号传参值做不同的事情）
state: 给定向后的组件传递一些信息</code></pre>}</li>
<li>push: 如果设置了这个属性，当前跳转的地址会加入到 history stack 中一条记录</li>
<li>from: 设定当前来源的页面地址</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter, Route, Switch, Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> A <span class="keyword">from</span> <span class="string">'./component/A'</span>;</span><br><span class="line"><span class="keyword">import</span> B <span class="keyword">from</span> <span class="string">'./component/B'</span>;</span><br><span class="line"><span class="keyword">import</span> C <span class="keyword">from</span> <span class="string">'./component/C'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">	&lt;Switch&gt;</span><br><span class="line">		&lt;Route path='/' exact component=&#123;A&#125; /&gt;</span><br><span class="line">		&lt;Route path='/user/' component=&#123;B&#125; /&gt;</span><br><span class="line">  	&lt;Route path='/pay' render=&#123;() =&gt; &#123;</span><br><span class="line">      //=&gt; 一般在 render 中处理的是权限校验</span><br><span class="line">      let flag = localStorage.getItem('FLAG');</span><br><span class="line">      if (flag &amp;&amp; flag === 'STATE') &#123;</span><br><span class="line">        return &lt;C/&gt;;</span><br><span class="line">      &#125;</span><br><span class="line">      return '当前环境不安全，不利于支付'</span><br><span class="line">    &#125;&#125;/&gt;</span><br><span class="line"></span><br><span class="line">		&#123;/* 上述情况设置完成后，会在末尾设置一个匹配：以上都不符合的情况下，我们认为路由地址是非法的地址，做一些特殊处理（route 不设置 path 是匹配所有地址规则的）*/&#125;</span><br><span class="line">		&#123;/* &lt;Route render=&#123;() =&gt; &#123;</span><br><span class="line">      return &lt;div&gt;404&lt;/div&gt;</span><br><span class="line">    &#125;)/&gt; */&#125;</span><br><span class="line"></span><br><span class="line">		&#123;/* 也可以基于Redirect进行重定向</span><br><span class="line">    	*		to [string]: 重新定向到新的地址</span><br><span class="line">    	*</span><br><span class="line">    	*		to [object]: 重新定向到新的地址，只不过制定了更多的信息</span><br><span class="line">    	* 		&#123;</span><br><span class="line">    	*				pathname: 定向的地址</span><br><span class="line">    	*				search: 给定向的地址问号传参（真实项目中，有时会根据是否存在问号传参数值来统计是正常进入首页还是非正常跳转过来的，也有可能根据问号传参值做不同的事情）</span><br><span class="line">    	*				state: 给定向后的组件传递一些信息</span><br><span class="line">    	*			&#125;</span><br><span class="line">    	*		push: 如果设置了这个属性，当前跳转的地址会加入到 history stack 中一条记录</span><br><span class="line">    	*</span><br><span class="line">    	*		from: 设定当前来源的页面地址</span><br><span class="line">    	*			&lt;Redirect from='/custom' to='/custom/list'/&gt;</span><br><span class="line">    	*			如果当前请求的 hash 地址是 “/custom”，将其重定向到 “/custom/list”</span><br><span class="line">    	*/&#125;</span><br><span class="line">		&lt;Redirect to='/'/&gt;</span><br><span class="line"></span><br><span class="line">    &#123;/* 与下面的效果一模一样</span><br><span class="line">    	*	&lt;Redirect to='/?lx=404'/&gt; </span><br><span class="line">    	*/&#125;</span><br><span class="line">		&lt;Redirect to=&#123;&#123;</span><br><span class="line">			pathname: '/',</span><br><span class="line">			search: '?lx=404'</span><br><span class="line">    &#125;&#125;/&gt;</span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<h3 id="NavLink-amp-Link"><a href="#NavLink-amp-Link" class="headerlink" title="NavLink &amp; Link"></a>NavLink &amp; Link</h3><p><strong>Link</strong></p>
<p>Link 是 React-Router 中提供的路由切换组件，基于它可以实现点击时路由的切换</p>
<blockquote>
<p><strong>原理：基于 Link 组件渲染，渲染后的结果就是一个 <code>a</code> 标签，to 对应的信息最后变为 <code>href</code> 中的内容</strong></p>
</blockquote>
<ul>
<li><p>to [string]: 跳转到指定的路由地址</p>
</li>
<li><p>to [object]: 可以提供一些参数配置项（和 Redirect 类似）</p>
<p>{</p>
<pre><code>pathname: 跳转地址
search: 问号传参
state: 基于这种方式传递信息</code></pre><p> }</p>
</li>
<li><p>replace [boolean]: 是替换 history stack 中当前的地址（true），还是追加一个新的地址（默认值是 false）</p>
</li>
</ul>
<p><strong>NavLink</strong></p>
<p>NavLink 和 Link 类似，都是为了实现路由切换跳转的，不同在于，NavLink 组件在当前页面 hash 和组件对应地址吻合的时候，会默认给组件叫一个 active 样式，让其有选中态</p>
<ul>
<li>和 Link 类似，to 和 replace 等属性都有，用法一样</li>
<li>activeClassName: 把默认加的 active 样式类改为自己设定的</li>
<li>activeStyle: 给匹配的这个 NavLink 设置行内样式</li>
<li>exact &amp; strict: 控制匹配的时候是否是严格匹配</li>
<li>isActive: 匹配后执行对应的函数</li>
</ul>
<blockquote>
<p>注意：NavLink 不是点击谁，谁就有选中样式（但是可以路由器换），而且当前页面哈希后的地址和 NavLink 中的 to 进行比较，哪个匹配了，哪个才有选中样式</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;HashRouter, Route, Switch, Redirect, Link, NavLink&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line">&lt;Link to=<span class="string">'/'</span> exact&gt;&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 最后也会转换为 a 标签，如果当前页面的 hash 地址和此组件中的 to 地址匹配了，则会给渲染后的 a 标签设置默认的样式类：active</span></span><br><span class="line"><span class="regexp">&lt;NavLink to='/</span>custom<span class="string">'&gt;&lt;/NavLink&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="withRouter"><a href="#withRouter" class="headerlink" title="withRouter"></a>withRouter</h3><p>withRouter 是把一个非路由管控的组件，模拟成为路由管控的组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">''</span> component=&#123;&#125;/&gt; <span class="comment">// 受路由管控的组件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">withRouter(connect()(Component)); <span class="comment">// 先把 Component 高阶一下，返回的是一个代理组件 Proxy，把返回的代理组件受路由管控</span></span><br></pre></td></tr></table></figure>

<p>解决问题：路由公共组件是非路由管控的组件，使用 NavLink 样式无法及时更新，使用 withRouter 将它包起来后就可以实现样式即时更新了</p>
<h3 id="受路由管控组件的特点"><a href="#受路由管控组件的特点" class="headerlink" title="受路由管控组件的特点"></a>受路由管控组件的特点</h3><ol>
<li><p>只有当前页面的哈希地址（/#/…）和路由指定的地址（path）匹配，才会把对应的组件渲染（withRouter 是没有地址匹配，都被模拟成为受路由管控的）</p>
</li>
<li><p>路由切换的原理：凡是匹配的路由，都会把对应的组件内容，重新添加到页面中，相反，不匹配的都会在页面中移除掉，下一次重新匹配上，组件需要重新渲染到页面中；每一次路由切换的时候（页面的哈希路由地址改变），都会从一级路由开始重新校验一遍</p>
</li>
<li><p>⚠️ 所有受路由管控的组件，在组件的属性 props 上都默认添加了三个属性</p>
<ul>
<li><p>history</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/images/frame/react/2.png" alt="image-20191106000238691"></p>
<ul>
<li><p>push：向 history stack 历史信息栈（池子）中追加一条新的信息，达到切换指定路由地址的目的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.history.push(<span class="string">'/plan'</span>) <span class="comment">// JS 中实现路由切换</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>go：跳转到指定的地址（传的是数字  <code>0 当前</code>  <code>-1 上一个</code>  <code>-2 上两个</code>）</p>
</li>
<li><p>goBack：相当于 go(-1) 回退到上一个地址</p>
</li>
<li><p>goForward：相当于 go(1) 向前走一步</p>
</li>
<li><p>…</p>
</li>
</ul>
</li>
<li><p>location：获取当前哈希路由渲染组件的一些信息</p>
<ul>
<li>pathname：当前哈希路由地址</li>
<li>search：当前页面的问号传参值</li>
<li>state：基于 Redirect / Link / NavLink 中的 to，传递的是一个对象，对象中编写的 state，就可以在 location.state 中获取到</li>
</ul>
</li>
<li><p>match：获取的是当前路由匹配的一些结果</p>
<ul>
<li>params：如果当前路由匹配的是地址路径参数，则这里可以获取传递参数的值</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>在 SPA 路由管控的项目中，从列表跳转到详情，总需要传递一些信息给详情组件，以此来展示不同的信息，传递给详情页信息的方式有好多种</strong></p>
<ul>
<li><p>[不推荐]</p>
<ul>
<li><p>本地存储</p>
</li>
<li><p>redux 存储</p>
<p>=&gt; 点击列表当某一项的时候，把信息存储到本地或者 redux 中，跳转到详情页面，把信息从本地或者 redux 中获取到即可，这样也算实现了信息的共享</p>
</li>
</ul>
</li>
<li><p>[推荐]</p>
<ol>
<li><p>问号传参</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二级路由管理</span></span><br><span class="line">&lt;Route path=<span class="string">'/custom/detail'</span> component=&#123;Detail&#125; /&gt;</span><br><span class="line"><span class="comment">// 跳转到指定 id 的 detail</span></span><br><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">	pathname: <span class="string">'/custom/detail'</span>,</span><br><span class="line">	search: <span class="string">`?id=<span class="subst">$&#123;id&#125;</span>`</span> <span class="comment">//=&gt; 问号传参</span></span><br></pre></td></tr></table></figure>
<p>}}&gt;<br>// detail 中的配置<br>let {location: {search}, data} = this.props,</p>
<pre><code>customID = Qs.parse(search.substr(1)).id || 0;</code></pre><p>customID = parseFloat(customID);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. 基于 state 传值（弊端：一旦页面刷新，上一次传递的 state 值就没有了，可以应用在支付页面）</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96;js</span><br><span class="line">   &#x2F;&#x2F; 二级路由管理</span><br><span class="line">   &lt;Route path&#x3D;&#39;&#x2F;custom&#x2F;detail&#39; component&#x3D;&#123;Detail&#125; &#x2F;&gt;</span><br><span class="line">   &#x2F;&#x2F; 跳转到指定 id 的 detail</span><br><span class="line">   &lt;Link to&#x3D;&#123;&#123;</span><br><span class="line">   	pathname: &#39;&#x2F;custom&#x2F;detail&#39;,</span><br><span class="line">   	state: id &#x2F;&#x2F;&#x3D;&gt; 2. state 传值</span><br><span class="line">   &#125;&#125;&gt;</span><br><span class="line">   &#x2F;&#x2F; detail 中的配置</span><br><span class="line">   let &#123;location: &#123;state&#125;, data&#125; &#x3D; this.props,</span><br><span class="line">     customID &#x3D; state || 0;</span><br><span class="line">   customID &#x3D; parseFloat(customID);</span><br></pre></td></tr></table></figure>
</li>
<li><p>url 地址参数：把参数当作地址的一部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二级路由管理</span></span><br><span class="line">&lt;Route path=<span class="string">'/custom/detail/:id'</span> component=&#123;Detail&#125;/&gt;</span><br><span class="line"><span class="comment">// 跳转到指定 id 的 detail</span></span><br><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">	pathname: <span class="string">`/custom/detail/<span class="subst">$&#123;id&#125;</span>`</span> <span class="comment">//=&gt; url 地址参数</span></span><br></pre></td></tr></table></figure>
<p>}}&gt;<br>// detail 中的配置<br>let {match: {params}, data} = this.props,</p>
<pre><code>customID = params.id || 0</code></pre><p>customID = parseFloat(customID);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 受保护的路由</span><br><span class="line"></span><br><span class="line">我们想对一些路由进行屏蔽,例如登录后才能访问,这里我们在本地存一个变量来表示是否登录,增加一个登录路由，点击登录按钮将本地变量改为登录成功状态,即可以访问用户列表页面</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">&#x2F;&#x2F; 我们匹配到&#x2F;user路由时要根据状态判断是否有权限，如果没权限需要跳转到登录页面，主要靠的是高阶组件的思想来实现:</span><br><span class="line">import React from &#39;react&#39;;</span><br><span class="line">import &#123;Route,Redirect&#125; from &#39;react-router-dom&#39;</span><br><span class="line">export default (&#123;component:Component,...others&#125;)&#x3D;&gt;&#123;</span><br><span class="line">   return &lt;Route &#123;...others&#125; render&#x3D;&#123;(props)&#x3D;&gt;&#123;</span><br><span class="line">       return localStorage.getItem(&#39;loginSystem&#39;)</span><br><span class="line">         ? &lt;Component &#123;...props&#125;&#x2F;&gt;</span><br><span class="line">     		 &#x2F;&#x2F; Redirect组件是用来重定向的，我们新增from属性来记录当前匹配的url,为了保证登录后可以在跳回到当前匹配的路径</span><br><span class="line">         : &lt;Redirect to&#x3D;&#123;&#123;</span><br><span class="line">          	 pathname:&#39;&#x2F;login&#39;,</span><br><span class="line">          	 from:props.match.url</span><br><span class="line">       		 &#125;&#125;&#x2F;&gt;</span><br><span class="line">   &#125;&#125;&#x2F;&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 新增 Login 组件</span><br><span class="line">&lt;div className&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;Route path&#x3D;&quot;&#x2F;home&quot; component&#x3D;&#123;Home&#125;&#x2F;&gt;</span><br><span class="line">    &lt;PrivateRoute path&#x3D;&quot;&#x2F;profile&quot; component&#x3D;&#123;Profile&#125;&#x2F;&gt;</span><br><span class="line">    &lt;Route path&#x3D;&quot;&#x2F;user&quot; component&#x3D;&#123;User&#125;&#x2F;&gt;</span><br><span class="line">    &lt;Route path&#x3D;&quot;&#x2F;login&quot; component&#x3D;&#123;Login&#125;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F; 我们发现默认点击profile会默认跳转到login组件中，点击登录可以再次跳回profile。这样我们就实现了受保护的路由。</span><br><span class="line">import React from &#39;react&#39;;</span><br><span class="line">export default class Login extends React.Component&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button className&#x3D;&quot;btn btn-primary&quot; onClick&#x3D;&#123;()&#x3D;&gt;&#123;</span><br><span class="line">                    window.localStorage.setItem(&#39;loginSystem&#39;,true);</span><br><span class="line">                   this.props.history.push(this.props.location.from)</span><br><span class="line">                &#125;&#125;&gt;登录&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h3 id="自定义菜单（MenuLink）"><a href="#自定义菜单（MenuLink）" class="headerlink" title="自定义菜单（MenuLink）"></a>自定义菜单（MenuLink）</h3><p>我们想给点击后的菜单增加激活样式，同样依然采用高阶组件的方式进行包装（此组件是用来替换掉原有的Link组件，并且在内部进行判断是否增加激活状态）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route,Link&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123;to,label&#125;)=&gt;&#123;</span><br><span class="line">  	<span class="comment">// 这里有个children属性和以前render不同，children无论是否路由匹配到都会执行此函数。而render只要在匹配到后才会执行</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">children</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;</span></span><br><span class="line">        return &lt;li className=&#123;props.match?'active':''&#125;&gt;</span><br><span class="line">          &lt;Link to=&#123;to&#125;&gt;&#123;label&#125;&gt;&lt;/Link&gt;</span><br><span class="line"><span class="xml">      	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;&#125;/&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h3><p>我们希望在添加页的输入框中输入内容后点击其他路由时先询问一下是否需要跳转。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">show</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;Prompt when=&#123;<span class="keyword">this</span>.state.show&#125; message=&#123;location =&gt; (</span><br><span class="line">        <span class="string">`Are you sure you want to go to <span class="subst">$&#123;location.pathname&#125;</span>?`</span> <span class="comment">//</span></span><br></pre></td></tr></table></figure>
<pre><code>)}/&gt;
&lt;form onSubmit={this.handleSubmit}&gt;
    &lt;div className=&quot;form-group&quot;&gt;
        &lt;label htmlFor=&quot;username&quot;&gt;用户名&lt;/label&gt;
        &lt;input type=&quot;text&quot; className=&quot;form-control&quot; ref={(x)=&gt;this.x=x}
           onChange={(e)=&gt;{
               if(e.target.value.length&gt;0){
                   this.setState({show:true})
               }
           }
        /&gt;
    &lt;/div&gt;
    &lt;div className=&quot;form-group&quot;&gt;
        &lt;button className=&quot;btn btn-primary&quot; &gt;添加&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;</code></pre></div>
// 监听输入框中的内容,当有内容时将状态show变为true,当需要跳转路由时Prompt的组件when属性为true就会提示对应的message,当然我们点击添加时不需要弹出,所以先将状态改为false在进行跳转即可。
handleSubmit=(e)=>{
    e.preventDefault();
    let list = JSON.parse(localStorage.getItem('lists')) || [];
    list.push({id:Math.random(),name:this.x.value});
    localStorage.setItem('lists',JSON.stringify(list));
      // 要等待状态改变后在执行跳转，因为setState是异步的所以要将跳转逻辑放的回调函数中。
    this.setState({show:false},()=>{
        this.props.history.push('/profile/list')
    })
};
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### NotFound 页面</span><br><span class="line"></span><br><span class="line">我们需要当路由都匹配不到时显示一个404页面,增加一个404组件</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">import React from &#39;react&#39;;</span><br><span class="line">export default class NotFound extends React.Component&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;NotFound&lt;&#x2F;div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 新增404路由：这里我们使用switch组件当全部匹配不到时会默认渲染404路由,这样我们就实现了404页面</span><br><span class="line">&lt;div className&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;Switch&gt;</span><br><span class="line">        &lt;Route path&#x3D;&quot;&#x2F;home&quot; component&#x3D;&#123;Home&#125;&#x2F;&gt;</span><br><span class="line">        &lt;PrivateRoute path&#x3D;&quot;&#x2F;profile&quot; component&#x3D;&#123;Profile&#125;&#x2F;&gt;</span><br><span class="line">        &lt;Route path&#x3D;&quot;&#x2F;user&quot; component&#x3D;&#123;User&#125;&#x2F;&gt;</span><br><span class="line">        &lt;Route path&#x3D;&quot;&#x2F;login&quot; component&#x3D;&#123;Login&#125;&#x2F;&gt;</span><br><span class="line">        &lt;Route component&#x3D;&#123;NotFound&#125;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;Switch&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>


<h2 id="7-React-常见问题"><a href="#7-React-常见问题" class="headerlink" title="7. React 常见问题"></a>7. React 常见问题</h2><ol>
<li>如果设置两个this.setState({num: this.state.num + 1})，结果仍然是加一？</li>
</ol>
<ul>
<li>解析：setState 有两个作用：1.对象； 2.函数：当下一个状态用到上一个状态时，使用函数；如果连续两次修改state，需要写成函数的方式（this.setState((prevState) =&gt; ({this.state.num + 1}) ）【如果设置多个状态 setState 会合并，如果下一个状态依赖于上一个状态，需要写成函数的方式】</li>
</ul>
<ol start="2">
<li>setState 是同步的还是异步的？</li>
</ol>
<ul>
<li>解析：有时候是同步，有时候是异步；在生命周期的钩子函数 / react 事件绑定中是异步更新的；在定时器（延时回调）的回调中 / 原生事件绑定的回调中不一定是同步；=&gt; setState不能保证同步执行 =&gt; 封装setState（setState的源码）； </li>
</ul>
<ol start="3">
<li>react 中组件之间通信如何完成？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="4">
<li>MVVM（双向数据流） 和 MVC（单向数据流） 的区别？/ Vue 和 React 的区别？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="5">
<li>react 中 redux 的实现原理？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="6">
<li>react 中 render 的实现原理？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="7">
<li>react-redux 的实现原理？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="8">
<li>JSX 元素实现原理？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="9">
<li>react中的性能优化？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="10">
<li>react 中缓存方式？</li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="11">
<li>为什么要使用 redux？</li>
</ol>
<ul>
<li>解析：没有使用 redux 之前一直通过属性来进行组件中的数据传递,这种模式是非常脆弱的。在日常的开发中经常会遇到非父子组件传递的场景。原来的方式是找到共同的父级进行数据交互，这时通信就变得比较麻烦</li>
</ul>
<ol start="12">
<li>为什么要使用高阶组件？</li>
</ol>
<ul>
<li>解析：当逻辑可能还会被复用的时候，从本地存储中获取数据放到输入框内的逻辑应该就是公用逻辑，这是就要使用高阶组件，也就是将组件在原有的基础上进行包装（将公共的逻辑拿到外层组件，处理好后以属性的方式传递给原本的组件，为此高阶组件就是一个 React 组件包裹着另外一个 React 组件）</li>
</ul>
<ol start="13">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="14">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="15">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="16">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="17">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="18">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="19">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<ol start="20">
<li></li>
</ol>
<ul>
<li>解析：</li>
</ul>
<h2 id="8-React-基础知识复习"><a href="#8-React-基础知识复习" class="headerlink" title="8. React 基础知识复习"></a>8. React 基础知识复习</h2><ol>
<li><p>React 是 facebook 公司开发的一款 MVC 版 JS 框架</p>
<ul>
<li>MVC：Model（数据层）、View（视图层）、Controller（控制层）</li>
<li>核心思想：通过数据的改变来影响视图的渲染（数据驱动）</li>
</ul>
</li>
<li><p>基于脚手架 create react app 快速构建一个 React 工程项目结构</p>
<ul>
<li><p>自动安装 React 的核心组件：React / React-dom</p>
</li>
<li><p>自动安装 webpack，并且完成相关的配置</p>
<ul>
<li>区分了开发环境和生产环境</li>
<li>安装 babel 以及对应的语言解析包，可以把 React 和 ES6 进行编译处理</li>
<li>安装 css / style / file 等加载器，处理 css 等合并压缩的问题</li>
<li>安装 eslint，可以进行代码检测</li>
<li>安装了很多的插件，可以实现 JS 和 css 以及 html 的分离、打包、压缩等</li>
<li>安装了 webpack-dev-server，可以在开发环境下，编译后自动创建服务，打开浏览器，当代码修改后，自动保存编译，页面自动刷新渲染等</li>
<li>。。。</li>
</ul>
</li>
<li><p>使用脚手架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">把脚手架安装到全局环境下，以后应用命令操作，完成项目结构的搭建</span><br><span class="line">$ npm install create-react-app -g </span><br><span class="line"></span><br><span class="line">创建项目结构目录(项目名遵循 npm 发包命名规范：名字只能是&#x2F;^[a-z0-9_-]$&#x2F;)</span><br><span class="line">$ create-react-app 项目名</span><br><span class="line"></span><br><span class="line">特点：如果当前电脑安装了 yarn，创建工程目录的时候，走的是 yarn 安装，yarn 和 npm 主体相同，但是处理起来还有一定的区别，所以我们以后继续向工程中安装模块以及执行配置脚本打包编译的时候，尽可能使用 yarn，不建议和 npm 混用</span><br></pre></td></tr></table></figure>
</li>
<li><p>工程化目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|- node_modules</span><br><span class="line">|		|- .bin 所有在本地可执行的命令脚本（react-script.cmd）</span><br><span class="line">|		|- ...</span><br><span class="line">|</span><br><span class="line">|- package.json 当前项目的配置清单</span><br><span class="line">|</span><br><span class="line">|- public 存放的是当前项目的HTML页面（有可能放一部分静态资源）</span><br><span class="line">| 	|- index.html</span><br><span class="line">|   |- ...</span><br><span class="line">|</span><br><span class="line">|- src 存放的是项目需要的所有 JS 或者静态资源等（包括组件、store、路由、数据模型、ajax请求等等内容 “开发的内容基本上所有东西都在 src 中写”）</span><br><span class="line">| 	|- index.js 当前项目的入口文件</span><br><span class="line">| 	|- ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>暴漏 webpack 配置项</p>
<blockquote>
<p>脚手架构建项目的时候，为了结构的美化，把所有的 webpack 配置等都隐藏到了 node_modules 中（react-scripts 中），真实项目中，我们经常会基于脚手架构建的结构自己再安装配置一些信息（例如：less 处理的配置），此时我们需要把配置项暴漏出来</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ yarn eject 此操作是不可逆转的（而且操作之前需要把所有修改的文件提交到 git 仓库中）</span><br><span class="line"></span><br><span class="line">|- config</span><br><span class="line">| 	|- webpack.config.dev.js 开发环境下的webpack配置</span><br><span class="line">| 	|- webpack.config.prod.js 生产环境下的webpack配置</span><br><span class="line">| 	|- path.js 基本配置项（包含项目的入口信息）</span><br><span class="line">| 	|- ...</span><br><span class="line">|</span><br><span class="line">|- scripts</span><br><span class="line">| 	|- start.js &#x2F; build.js &#x2F;test.js 当我们执行 yarn start&#x2F;build&#x2F;test 的时候，执行的就是这三个 JS 文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>可执行的本地脚本命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ yarn start 开发预览</span><br><span class="line">	-&gt; 创建一个端口号为3000，协议为 http 的 web 服务</span><br><span class="line">	-&gt; 按照 webpack.config.dev.js 把项目编译</span><br><span class="line">	-&gt; 打开浏览器，预览我们正在开发的项目</span><br><span class="line">	-&gt; 当项目文件修改的时候，自动重新编译，浏览器页面自动刷新，展示最新的效果</span><br><span class="line">	[windows]</span><br><span class="line">	$ set HTTPS&#x3D;true&amp;&amp;yarn start &#x2F;&#x2F; 设置 https 协议</span><br><span class="line">	$ set PORT&#x3D;1234&amp;&amp;yarn start &#x2F;&#x2F; 将端口号设置为自定义端口号</span><br><span class="line">	[mac&#x2F;linux]</span><br><span class="line">	$ HTTPS&#x3D;true&amp;&amp;yarn start</span><br><span class="line">	$ PORT&#x3D;1234&amp;&amp;yarn start</span><br><span class="line"></span><br><span class="line">$ yarn build </span><br><span class="line">	-&gt; 生成一个 build 文件夹，存放最后打包的文件</span><br><span class="line">	-&gt; 基于 webpack.config.prod.js 把项目进行编译打包</span><br><span class="line">	-&gt; 部署上线的时候，只需要把 build 中的内容发布即可</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于脚手架配置 less</p>
<ul>
<li><p>安装 less 和对应的加载器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add less less-loader</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改开发和生产环境下的 webpack 配置项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[DEV]</span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(css|less)&amp;/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="built_in">require</span>.resolve(<span class="string">'css-loader'</span>),</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  ], </span><br><span class="line">&#125;</span><br><span class="line">[PROD]</span><br><span class="line">&#123;</span><br><span class="line">	test: <span class="regexp">/\.(css|less)&amp;/</span>,</span><br><span class="line">  loader: ExtractTextPlugin.extract(</span><br><span class="line">  	<span class="built_in">Object</span>.assign(</span><br><span class="line">    	&#123;</span><br><span class="line">    		fallback: &#123;</span><br><span class="line">    			loader: <span class="built_in">require</span>.resolve(<span class="string">'style-loader'</span>),</span><br><span class="line">          options: &#123;</span><br><span class="line">            hmr: <span class="literal">false</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">    		&#125;,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="built_in">require</span>.resolve(<span class="string">'css-loader'</span>),</span><br><span class="line">            ...</span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="built_in">require</span>.resolve(<span class="string">'less-loader'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">    	&#125;,</span><br><span class="line">     	extractTextPluginOptions</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>React 是基于独有的 JSX 语法实现视图（数据和 HTML）渲染的</p>
</li>
<li><p>JSX 语法</p>
<ul>
<li><p>JSX 语法的渲染使用的是 ReactDOM.render</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render([JSX元素], [指定的容器], [回调函数：当我们把 JSX放到指定容器内，触发执行的函数])</span><br></pre></td></tr></table></figure>
</li>
<li><p>JSX = JavaScript + XML（HTML）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. 不推荐存放 JSX 的容器是 BODY（写 BODY 会报错），一般都是使用我们自己创建的一个元素（例如：创建 #root 的 div 容器等）</span><br><span class="line"></span><br><span class="line">2. 不允许出现两个“根”元素，如果需要绑定复杂的结构，最外层嵌套一个容器作为根元素即可</span><br><span class="line"></span><br><span class="line">3. 把数据嵌入到 JSX 中（不是嵌入到元素的属性中，而是正常的内容中）</span><br><span class="line">	-&gt; 可以潜入变量或者直接的数据值</span><br><span class="line">	-&gt; 不能嵌入对象（代指：&#123;&#125;、&#x2F;^&amp;&#x2F;、日期对象、函数或者数组中的某一项是嵌入的也不行[一维简单的数组是可以的]）</span><br><span class="line">	-&gt; 可以嵌入基本类型的值（null&#x2F;undefined&#x2F;布尔值都是空元素，也就是也就是不显示任何的内容）</span><br><span class="line">	-&gt; 大括号中可以嵌入 JS 表达式（执行 JS 代码需要有返回结果的）</span><br><span class="line">		-&gt; 循环创建的 JSX 元素需要设置标示 key，并且在当前循环的时候，这个 key 需要唯一；而使用 map 是因为他有返回值，返回的是替换后的数组</span><br><span class="line">		-&gt; 使用三元运算符解决判断操作，（if 和 switch 都不可以）</span><br><span class="line">	</span><br><span class="line">4. 可以给 JSX 元素设置元素</span><br><span class="line">	-&gt; 属性值对应大括号中 对象、函数 都可以放（也可以放JS表达式）</span><br><span class="line">	-&gt; style 属性值必须是对象（不能是字符串）</span><br><span class="line">	-&gt; class 用 className 代替</span><br><span class="line">	-&gt; ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>JSX 语法转换</p>
<ul>
<li><p>JSX 语法：JSX 元素 / React 元素 / 虚拟 DOM</p>
</li>
<li><p>React 是如何把 JSX 元素转换为真实的DOM元素并且添加到页面中？</p>
<ol>
<li><p>基于 babel / babel-loader / babel-preset-react-app 把 JSX 语法编译为 React.createElement 这种模式</p>
<ul>
<li>createElement 中至少有两个参数，没有上限<ul>
<li>第一个：目前是当前元素标签的标签名（字符串）</li>
<li>第二个：属性（没有给元素设置属性则为 null）</li>
<li>其它的：当前元素的所有子元素内容（只要子元素是 html，就会变为新的createElement）</li>
</ul>
</li>
</ul>
</li>
<li><p>执行 createElement，把传递进来的参数最后处理成一个对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	type: &#39;标签名&#39;,</span><br><span class="line">	props: &#123;</span><br><span class="line">		自己设置的那些属性对象（但是对于 key 和 ref 来说是要提取出来的）,</span><br><span class="line">		children: 存放自己子元素的（没有子元素就没有这个属性），如果有多个子元素，就以数组的形式存储信息</span><br><span class="line">	&#125;,</span><br><span class="line">	ref: null,</span><br><span class="line">	key: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把生成的对象交给 render 进行处理：把对象编程DOM元素，插入到指定的容器中</p>
</li>
</ol>
</li>
<li><p>重新 createElement</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=&gt; createElement</span></span><br><span class="line"><span class="keyword">let</span> createElement = <span class="function">(<span class="params">type, props, ...children</span>) =&gt;</span> &#123;</span><br><span class="line">  props = props || &#123;&#125;;</span><br><span class="line">  <span class="comment">//=&gt; ref &amp;&amp; key</span></span><br><span class="line">  <span class="keyword">let</span> ref = <span class="literal">null</span>,</span><br><span class="line">      key = <span class="literal">null</span>;</span><br><span class="line">  <span class="string">'ref'</span> <span class="keyword">in</span> props ? (ref = props[<span class="string">'ref'</span>], props[<span class="string">'ref'</span>] = <span class="literal">undefined</span>) : <span class="literal">null</span>;</span><br><span class="line">  <span class="string">'key'</span> <span class="keyword">in</span> props ? (ref = props[<span class="string">'ref'</span>], props[<span class="string">'ref'</span>] = <span class="literal">undefined</span>) : <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">  	type, <span class="comment">//=&gt; type: type</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      <span class="comment">//=&gt; 保证children是一项或者是数组多项</span></span><br><span class="line">      children: children.length &lt; <span class="number">1</span> ? (children[<span class="number">0</span>] || <span class="string">''</span>) : children</span><br><span class="line">    &#125;,</span><br><span class="line">    ref,</span><br><span class="line">    key,</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    $$typeof: Symbol(React.element),</span></span><br><span class="line"><span class="comment">    _owner: null,</span></span><br><span class="line"><span class="comment">    _store: &#123;</span></span><br><span class="line"><span class="comment">      validated: false</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    _self: null,</span></span><br><span class="line"><span class="comment">    _source: null </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//=&gt; render</span></span><br><span class="line"><span class="keyword">let</span> render = <span class="function">(<span class="params">objJsx, container, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;type, props&#125; = objJsx,</span><br><span class="line">      &#123;children&#125; = props,</span><br><span class="line">      newElement = <span class="built_in">document</span>.createElement(types);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> props) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!objJsx.hasOwnProperty(attr)) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">let</span> valueJsx = objJsx[attr];</span><br><span class="line">    <span class="keyword">typeof</span> valueJsx === <span class="string">'undefined'</span> ? valueJsx = <span class="string">''</span> : <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//=&gt; 事件属性处理</span></span><br><span class="line">    <span class="keyword">let</span> regEvent = <span class="regexp">/^on/</span></span><br><span class="line">    <span class="keyword">if</span>(regEvent.test(attr)) &#123;</span><br><span class="line">      newElement.addEventListener(attr.toLowerCase().substr(<span class="number">2</span>), valueJsx.bind(<span class="literal">undefined</span>), <span class="literal">false</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//=&gt; 特殊属性处理</span></span><br><span class="line">    <span class="keyword">switch</span> (attr.toUpperCase()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'CLASSNAME'</span>:</span><br><span class="line">        newElement.setAttribute(attr, valueJsx);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'STYLE'</span>:</span><br><span class="line">       	<span class="keyword">for</span> (<span class="keyword">let</span> styAttr <span class="keyword">in</span> valueJsx) &#123;</span><br><span class="line">          <span class="keyword">if</span> (valueJsx.hasOwnProperty(styAttr)) &#123;</span><br><span class="line">            newElement.style[styAttr] = valueJsx[styAttr];</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'CHILDREN'</span>:</span><br><span class="line">        !(valueJsx <span class="keyword">instanceof</span> <span class="built_in">Array</span>) ? valueJsx = [valueJsx] : <span class="literal">null</span>;</span><br><span class="line">        valueJsx.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> item === <span class="string">'string'</span>) &#123;</span><br><span class="line">            newElement.appendChild(<span class="built_in">document</span>.createTextNode(item));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">          render(item, newElement);<span class="comment">//=&gt; 递归调用</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        newElement.setAttribute(attr, valueJsx);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  container.appendChild(newElement);</span><br><span class="line">  callback &amp;&amp; callback()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ol>
<ol start="6">
<li><p>组件</p>
<ul>
<li><p>真实项目中使用react都是基于组件或者模块开发的</p>
<ol>
<li>函数式创建组件：创建一个函数，里面返回一个 JSX<ul>
<li>props：调取组件的时候传递进来的属性信息（可能包含：className/style/id…还有可能有 children 等）【双闭合调取组件，就是为了传递子元素的；<code>props.children / React.Children.map(props.children, item =&gt; { return item })</code> 存放自己调取组件的时候，额外扩展的标记】</li>
</ul>
</li>
</ol>
<blockquote>
<p>函数式组件声明的特点</p>
<ol>
<li>会把基于 createElement 解析出来的对象中的 props 作为参数传递给组件（可以完成：多次调取组件传递不同的信息）</li>
<li>一旦组件调取成功，返回的 JSX 就会渲染到页面上，但是后期不通过重新调取组件或者获取 DOM 元素操作的方式，很难再把渲染好组件的内容更改 =&gt; <strong>函数式组件声明是“静态组件”</strong></li>
</ol>
</blockquote>
<ol start="2">
<li><p>基于类创建组件</p>
<ul>
<li><p><code>constructor(props) { super(props) };</code>     </p>
<p>super(props) =&gt; React.Component.call(this) 可以把 component 中的私有属性继承过来 this.props / this.state（this.setState）/ this.context / this.refs / this.updater</p>
</li>
<li><p>props / state 【通过组件状态来控制组件渲染的组件（由数据渲染）称为受控组件】</p>
</li>
<li><p>ref 是 React 中提供操作 DOM 的方案【直接操作 DOM 的为非受控组件】</p>
<ol>
<li>给需要操作的元素设置 ref（保持唯一性，否则会冲突覆盖）</li>
<li>在实例上挂载了 refs 属性，它是一个对象，存储了所有设置 ref 的元素（ref 值：元素对象）</li>
</ol>
</li>
<li><p>组件的属性是只读的，只能调取组件时传递进来，不能自己在组件内部修改（但是可以设置默认值和规则）</p>
<ul>
<li>组件的状态是可读写：状态改变会引发组件的重新更新（状态是基于 setState 改变）</li>
<li>组件实例上可以放一些信息：这些信息只是为了方便在组件内任意方法中获取和使用的</li>
<li>实例上挂载的 refs：就是用来操作 DOM 的</li>
<li>实例上挂载的 context：是用来实现组件之间信息传递的</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>基于类创建组件的特点</p>
<ol>
<li>调取组件相当于你创建类的实例（this），把一些私有的属性挂载到了实例上了，这样组件内容所有方法中都可以基于实例获取这些值（包括：传递的属性和自己管理的状态）</li>
<li>有自己的状态管理，当状态改变的时候，React 会重新渲染视图（差异更新：基于 DOM-diff 只把需要重新渲染的部分渲染即可）</li>
</ol>
</blockquote>
</li>
<li><p>调取组件的时候：babel解析，传递给 createElement 的第一个参数 type 不再是字符串标签名，而是一个函数（类），生成的对象中，type 也是一个函数；当 render 渲染的时候会根据 type 类型做不同的事情（如果是字符串就是创建新元素，如果是函数，就会把函数执行，把返回的 JSX 对象创建成为新的元素进行渲染），函数执行的时候会把解析出来的对象中的 props 作为参数传递给组件（函数）</p>
</li>
</ul>
</li>
<li><p>生命周期函数</p>
<ul>
<li><p>【调取组件】</p>
<ul>
<li>constructor</li>
<li>componentWillMount 第一次渲染之前</li>
<li>render 渲染</li>
<li>componentDidMount 第一次渲染之后</li>
</ul>
</li>
<li><p>【组件重新渲染：内部状态改变、传递给组件的属性改变】</p>
<ul>
<li><p>状态（state）改变</p>
<ul>
<li><p>shouldComponentUpdate</p>
<p>=&gt; 是否允许组件更新：返回 true 是允许，返回 false 则不再继续向下走</p>
</li>
<li><p>componentWillUpdate</p>
<p>=&gt; 更新之前：和 shouldComponentUpdate 一样，方法中通过 this.state.xxx 获取的还是更新前的状态信息，方法有两个参数：nextProps / nextState 存储的是最新的属性和状态信息</p>
</li>
<li><p>render 更新</p>
</li>
<li><p>componentDidUpdate 更新之后</p>
</li>
</ul>
</li>
<li><p>属性（props）改变</p>
<ul>
<li><p>componentWillReceiveProps(nextProps/nextState)</p>
<p>=&gt; 接受最新属性之前，基于 this.props.xxx 获取的是原有的属性信息，nextProps 存储的是最新传递的属性信息</p>
</li>
<li><p>shouldComponentUpdate 是否允许组件更新</p>
</li>
<li><p>componentWillUpdate 更新之前</p>
</li>
<li><p>render 更新</p>
</li>
<li><p>componentDidUpdate 更新之后</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>【组件销毁】</p>
<ul>
<li>componentWillUnmount 组件销毁之前</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="9-CRM-系统的结构"><a href="#9-CRM-系统的结构" class="headerlink" title="9. CRM 系统的结构"></a>9. CRM 系统的结构</h2><ul>
<li>OA：企业办公管理系统（偏向于有助于日常办公）</li>
<li>ERP：企业战略资源管理系统（偏向于有管理思想）</li>
</ul>
<blockquote>
<p>OA/ERP：钉钉、TAPD、今目标。。。</p>
</blockquote>
<ul>
<li>CRM：客户管理系统</li>
</ul>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/images/frame/react/3.png" alt="image-20191105221305786"></p>
<ul>
<li>CMS：内容管理系统</li>
</ul>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="/images/frame/react/4.png" alt="image-20191105215032118"></p>
<ul>
<li>IM：即时通讯系统</li>
</ul>
<h2 id="10-Demo-Project"><a href="#10-Demo-Project" class="headerlink" title="10. Demo Project"></a>10. Demo Project</h2><h3 id="CRM"><a href="#CRM" class="headerlink" title="CRM"></a>CRM</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">|- src</span><br><span class="line">	|- component【公共组件】</span><br><span class="line">		|- Nav.js</span><br><span class="line">	|- routes【页面】</span><br><span class="line">		|- App.js【路由管控，项目页面的主入口（和放到 index.js 中类似，只是写法不同而已，该项目不使用 App.js）】</span><br><span class="line">		|- Home.js</span><br><span class="line">		|- Custom.js</span><br><span class="line">		|- Plan.js</span><br><span class="line">		|- custom【Custom 子页面（二级路由）】</span><br><span class="line">			|- Create.js</span><br><span class="line">			|- Detail.js</span><br><span class="line">			|- List.js</span><br><span class="line">	|- store【redux】</span><br><span class="line">			|- action</span><br><span class="line">				|- custom.js</span><br><span class="line">				|- index.js</span><br><span class="line">			|- reducer</span><br><span class="line">				|- custom.js</span><br><span class="line">				|- index.js</span><br><span class="line">			|- action-types.js</span><br><span class="line">			|- index.js</span><br><span class="line">	|- utils</span><br><span class="line">	|- static【放 css、images...】</span><br><span class="line">		|- css</span><br><span class="line">			|- common.css </span><br><span class="line">	|- index.js【资源规划的入口】</span><br></pre></td></tr></table></figure>

<p>src/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* BASE */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter, Route, Switch, Redirect, Link, NavLink&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IMPORT COMPONENT*/</span></span><br><span class="line"><span class="comment">// import App from './routes/App';</span></span><br><span class="line"><span class="keyword">import</span> Nav <span class="keyword">from</span> <span class="string">'./component/Nav'</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./routes/Home'</span>;</span><br><span class="line"><span class="keyword">import</span> Custom <span class="keyword">from</span> <span class="string">'./routes/Custom'</span>;</span><br><span class="line"><span class="keyword">import</span> Plan <span class="keyword">from</span> <span class="string">'./routes/Plan'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IMPORT CSS */</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'boostrap/dist/css/boostrap.css'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./static/css/common.css'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line">  &lt;HashRouter&gt;</span><br><span class="line">  	&lt;div&gt;</span><br><span class="line">  		&#123;/* Nav: header 区域 */&#125;</span><br><span class="line">  		&lt;Nav /&gt;</span><br><span class="line">  		&#123;/* 基于 hashRouter 展示不同的页面 */&#125;</span><br><span class="line">			&#123;/* &lt;App /&gt; */&#125;</span><br><span class="line">  		&lt;Switch&gt;</span><br><span class="line">  			&lt;Route path='/' exact component=&#123;Home&#125;/&gt;</span><br><span class="line">      	&lt;Route path='/custom' component=&#123;Custom&#125;/&gt;</span><br><span class="line">      	&lt;Route path='/plan' component=&#123;Plan&#125;/&gt;</span><br><span class="line">      	&lt;Redirect to='/?lx=unsafe'/&gt;</span><br><span class="line">  		&lt;/Switch&gt;</span><br><span class="line">  	&lt;/div&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span>, root);</span><br></pre></td></tr></table></figure>

<p>src/static/css/common.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: lightskyblue <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="component"><a href="#component" class="headerlink" title="component"></a>component</h4><p>src/component/Nav.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Link, NavLink, withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nav</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">'navbar navbar-default'</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/*LOGO*/&#125;</span></span><br><span class="line">      &lt;div className='container-fluid col-md-2'&gt;</span><br><span class="line">        &lt;Link className='navbar-brand' to=&#123;&#123;</span><br><span class="line">        	pathname: '/',</span><br><span class="line">					search: '?lx=logo'</span><br><span class="line">        &#125;&#125;&gt;LOGO&lt;/Link&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	&#123;/*NAV*/&#125;</span></span><br><span class="line">    	&lt;div className='collapse navbar-collapse col-md-10'&gt;</span><br><span class="line">        &lt;ul className='nav navbar-nav'&gt;</span><br><span class="line">          &lt;li&gt;&lt;NavLink to='/' exact&gt;首页&lt;/NavLink&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;NavLink to='/custom'&gt;客户管理&lt;/NavLink&gt;&lt;/li&gt;</span><br><span class="line">          &lt;li&gt;&lt;NavLink to='/plan'&gt;计划管理&lt;/NavLink&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">export default withRouter(connect()(Nav));</span></span><br></pre></td></tr></table></figure>

<h4 id="routes"><a href="#routes" class="headerlink" title="routes"></a>routes</h4><p>src/routes/App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter, Route, Switch, Redirect, Link, NavLink&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./Home'</span>;</span><br><span class="line"><span class="keyword">import</span> Custom <span class="keyword">from</span> <span class="string">'./Custom'</span>;</span><br><span class="line"><span class="keyword">import</span> Plan <span class="keyword">from</span> <span class="string">'./Plan'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">  		&lt;Switch&gt;</span><br><span class="line">  			&lt;Route path='/' exact component=&#123;Home&#125;/&gt;</span><br><span class="line">        &lt;Route path='/custom' component=&#123;Custom&#125;/&gt;</span><br><span class="line">        &lt;Route path='/plan' component=&#123;Plan&#125;/&gt;</span><br><span class="line">        &lt;Redirect to='/?lx=unsafe'/&gt;</span><br><span class="line"><span class="xml">  		<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect()(App);</span><br></pre></td></tr></table></figure>

<p>src/routes/Home.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      我是HOME</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect()(Home);</span><br></pre></td></tr></table></figure>

<p>src/routes/Plan.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plan</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      我是PLAN</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect()(Plan);</span><br></pre></td></tr></table></figure>

<p>src/routes/Custom.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Route, Switch, Redirect, NavLink, Link&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'./custom/List'</span>;</span><br><span class="line"><span class="keyword">import</span> Create <span class="keyword">from</span> <span class="string">'./custom/Create'</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./custom/Detail'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Custom</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      &#123;/*左侧MENU导航*/&#125;</span></span><br><span class="line">    	&lt;ul className='nav nav-pills nav-stacked col-md-2'&gt;</span><br><span class="line">        &lt;li className='presentation'&gt;</span><br><span class="line">          &lt;NavLink to='/custom/list'&gt;客户列表&lt;/NavLink&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    		&lt;li className='presentation'&gt;</span><br><span class="line">          &lt;NavLink to='custom/create'&gt;增加客户&lt;/NavLink&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line"><span class="xml">    	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    	&#123;/*右侧展示对应的内容: 也是基于路由管理（二级路由）*/&#125;</span></span><br><span class="line">    	&lt;div className='col-md-10'&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">        	&lt;Route path='/custom/list' component=&#123;List&#125; /&gt;</span><br><span class="line">          &lt;Route path='/custom/create' component=&#123;Create&#125; /&gt;</span><br><span class="line">          &lt;Route path='/custom/detail/:id' component=&#123;Detail&#125; /&gt;</span><br><span class="line">          &#123;/*进入到客户管理页面，让其默认展示就是list区域内容，这有两种方式都可以*/&#125;</span><br><span class="line">          &lt;Redirect from='/custom' to='/custom/list' /&gt;</span><br><span class="line">          &lt;Route path='/custom' exact component=&#123;List&#125; /&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect()(Custom);</span><br></pre></td></tr></table></figure>

<p>src/routes/custom/Create.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">'../../store/action'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Create</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      用户编号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">ref</span>=<span class="string">'USER_ID'</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      用户姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">ref</span>=<span class="string">'USER_NAME'</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.submit&#125;</span>&gt;</span>新增用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  submit = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;USER_ID, USER_NAME&#125; = <span class="keyword">this</span>.refs,</span><br><span class="line">        &#123;create, history&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="comment">//=&gt; dispatch</span></span><br><span class="line">    create(&#123;</span><br><span class="line">      id: USER_ID.value,</span><br><span class="line">      name: USER_NAME.value</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//=&gt; go list</span></span><br><span class="line">    USER_ID.value = USER_NAME.value = <span class="string">''</span>;</span><br><span class="line">    history.push(<span class="string">'/custom/list'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;...state.custom&#125;), action.custom)(Create);</span><br></pre></td></tr></table></figure>

<p>src/routes/custom/Detail.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> Qs <span class="keyword">from</span> <span class="string">'qs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Detail</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    // 1. 问号传参</span></span><br><span class="line"><span class="comment">    let &#123;location: &#123;search&#125;, data&#125; = this.props,</span></span><br><span class="line"><span class="comment">        customID = Qs.parse(search.substr(1)).id || 0;</span></span><br><span class="line"><span class="comment">    customID = parseFloat(customID);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">    // 2. 基于 state 传值</span></span><br><span class="line"><span class="comment">    let &#123;location: &#123;state&#125;, data&#125; = this.props,</span></span><br><span class="line"><span class="comment">        customID = state || 0;</span></span><br><span class="line"><span class="comment">    customID = parseFloat(customID);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. url 地址参数</span></span><br><span class="line">    <span class="keyword">let</span> &#123;<span class="attr">match</span>: &#123;params&#125;, data&#125; = <span class="keyword">this</span>.props,</span><br><span class="line">        customID = params.id || <span class="number">0</span>; <span class="comment">//=&gt; path='/custom/detail/:id' 路由冒号后面的值就是以后解析是的属性名</span></span><br><span class="line">    customID = <span class="built_in">parseFloat</span>(customID);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//=&gt; 筛选和渲染</span></span><br><span class="line">    <span class="keyword">let</span> item = data.find(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">parseFloat</span>(item.id) === customID);</span><br><span class="line">    <span class="keyword">if</span> (!item) <span class="keyword">return</span> <span class="string">'当前用户不存在！'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      编号：&#123;item.id&#125;</span></span><br><span class="line"><span class="xml">    	<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line"><span class="xml">      姓名：&#123;item.name&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;...state.custom&#125;))(Detail);</span><br></pre></td></tr></table></figure>

<p>src/routes/custom/List.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Link&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props, context);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;data&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">'list-group'</span>&gt;</span> </span></span><br><span class="line"><span class="xml">      &#123;data.map((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        let &#123;id, name&#125; = item; </span></span><br><span class="line">        /*&lt;li onClick=&#123;e =&gt; &#123;this.props.history.push('/custom/detail')&#125;&#125;&gt;*/</span><br><span class="line">        return &lt;li className='list-group-item' key=&#123;index&#125;&gt;</span><br><span class="line">        	&lt;Link to=&#123;&#123;</span><br><span class="line">          	// pathname: '/custom/detail',</span><br><span class="line">            // search: `?id=$&#123;id&#125;`, //=&gt; 1. 问号传参</span><br><span class="line">            // state: id //=&gt; 2. state 传值</span><br><span class="line">            pathname: `/custom/detail/$&#123;id&#125;`, //=&gt; 3. url 地址参数</span><br></pre></td></tr></table></figure>
<pre><code>      }}&gt;
          编号：{id}
                &amp;nbsp;&amp;nbsp;
                姓名：{name}
      &lt;/Link&gt;
      &lt;/li&gt;
  })}
&lt;/ul&gt;;</code></pre><p>  }<br>}<br>export default connect(state =&gt; ({…state.custom}))(List);</p>
<p>/*</p>
<ul>
<li>在 SPA 路由管控的项目中，从列表跳转到详情，总需要传递一些信息给详情组件，以此来展示不同的信息，传递给详情页信息的方式有好多种</li>
<li>[不推荐]</li>
<li>本地存储</li>
<li>redux 存储</li>
<li>=&gt; 点击列表当某一项的时候，把信息存储到本地或者 redux 中，跳转到详情页面，把信息从本地或者 redux 中获取到即可，这样也算实现了信息的共享</li>
<li>[推荐]</li>
<li><ol>
<li>问号传参</li>
</ol>
</li>
<li><ol start="2">
<li>基于 state 传值（弊端：一旦页面刷新，上一次传递的 state 值就没有了，可以应用在支付页面）</li>
</ol>
</li>
<li><ol start="3">
<li>url 地址参数：把参数当作地址的一部分</li>
</ol>
</li>
<li><Route path='/custom/detail/:id' component={Detail}/></li>
<li></li>
<li>let {match: {params}, data} = this.props,</li>
<li>customID = params.id || 0; //=&gt; path=’/custom/detail/:id’ 路由冒号后面的值就是以后解析是的属性名</li>
<li>customID = parseFloat(customID);</li>
<li>/<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### store</span><br><span class="line"></span><br><span class="line">src&#x2F;store&#x2F;action&#x2F;custom.js</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">import * as Types from &#39;..&#x2F;action-types&#39;;</span><br><span class="line">let custom &#x3D; &#123;</span><br><span class="line">  &#x2F;&#x2F;&#x3D;&gt; 增加客户信息：payload &#x3D; &#123;id, name&#125;</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      type: Types.CUSTOM_CREATE,</span><br><span class="line">      payload</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &#x2F;*</span><br><span class="line">  &#x2F;&#x2F;&#x3D;&gt; 使用 redux-thunk 中间件处理</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">  	&#x2F;&#x2F;&#x3D;&gt; thunk 中间件的实用语法：在指定执行派发任务的时候，等待3000ms后再派发</span><br><span class="line">    return dispatch &#x3D;&gt; &#123;</span><br><span class="line">    	&#x2F;&#x2F;&#x3D;&gt; dispatch 都传递给我们了，想什么时候派发，自己搞定即可</span><br><span class="line">      setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">          type: Types.CUSTOM_CREATE,</span><br><span class="line">          payload</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, 3000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *&#x2F;</span><br><span class="line">  </span><br><span class="line">  &#x2F;*</span><br><span class="line">  &#x2F;&#x2F;&#x3D;&gt; 使用 redux-promise 中间件处理</span><br><span class="line">  create(payload) &#123;</span><br><span class="line">  	return &#123;</span><br><span class="line">  		type: Types.CUSTOM_CREATE,</span><br><span class="line">  		&#x2F;&#x2F;&#x3D;&gt; 传递给 reducer 的 payload 需要等待 promise 成功，把成功后的结果传递过去</span><br><span class="line">  		payload: new Promise(resolve &#x3D;&gt; &#123;</span><br><span class="line">  			resolve(payload);</span><br><span class="line">  		&#125;, 3000)</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *&#x2F;</span><br><span class="line">&#125;;</span><br><span class="line">export default custom;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>src/store/action/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> custom <span class="keyword">from</span> <span class="string">'./custom'</span>;</span><br><span class="line"><span class="keyword">let</span> action = &#123;</span><br><span class="line">  custom</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> action;</span><br></pre></td></tr></table></figure>

<p>src/store/reducer/custom.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Types <span class="keyword">from</span> <span class="string">'../action-types'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">custom</span>(<span class="params">state = &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  data: [&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    id: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    name: <span class="string">'handsomeBoy'</span></span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;]</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;, action</span>) </span>&#123;</span><br><span class="line">  state = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">		<span class="comment">//=&gt; 增加客户</span></span><br><span class="line">    <span class="keyword">case</span> Types.CUSTOM_CREATE:</span><br><span class="line">      <span class="keyword">let</span> &#123;payload&#125; = action;</span><br><span class="line">      state.data.push(payload);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/store/reducer/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> custom <span class="keyword">from</span> <span class="string">'./custom'</span>;</span><br><span class="line"><span class="keyword">let</span> reducer = combineReducers(&#123;</span><br><span class="line">  custom</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>

<p>src/store/action-types.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CUSTOM_CREATE = <span class="string">'CUSTOM_CREATE'</span>;</span><br></pre></td></tr></table></figure>

<p>src/store/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createStore, applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="comment">// 使用 redux 中间件</span></span><br><span class="line"><span class="keyword">import</span> reduxLogger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> reduxThunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> reduxPromise <span class="keyword">from</span> <span class="string">'redux-promise'</span>;</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer, applyMiddleware(reduxLogger, reduxThunk, reduxPromise));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:edsyang1102@gmail.com">Edsyang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.lagerstroemia.com.cn/2019/11/26/frame/react/react-basic/">http://blog.lagerstroemia.com.cn/2019/11/26/frame/react/react-basic/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.lagerstroemia.com.cn" target="_blank">Edsyang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/0081Kckwly1gkrf2rz04kj30m00ffq3z.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.png" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/11/27/frame/react/redux-saga/"><img class="prev_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redux Saga</div></div></a></div><div class="next-post pull_right"><a href="/2019/11/26/js/usedto/"><img class="next_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常用方法</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/21/frame/react/react-router/" title="React Router"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-21</div><div class="relatedPosts_title">React Router</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/12/frame/react/architecture/" title="React 知识架构"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-12</div><div class="relatedPosts_title">React 知识架构</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/10/frame/react/react-router-change-log/" title="React-Router Version differences"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-09</div><div class="relatedPosts_title">React-Router Version differences</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/10/frame/react/react-change-log/" title="React Version differences"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-09</div><div class="relatedPosts_title">React Version differences</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/10/frame/react/mvc/" title="MVC 框架模式"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-09</div><div class="relatedPosts_title">MVC 框架模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/10/frame/react/react-fiber/" title="Fiber 架构"><img class="relatedPosts_cover" data-src="https://tva1.sinaimg.cn/large/007S8ZIlly1gegal5ikmoj30u00xpe81.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-09</div><div class="relatedPosts_title">Fiber 架构</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'WgFk4Onl7sisfXpq9vHcehGJ-gzGzoHsz',
  appKey: '3DLR7iLY5al5dbIdo9kWnDHU',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Edsyang</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>冀ICP备19038398号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/search/local-search.js"></script></body></html>